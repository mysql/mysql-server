
--echo # Bug#22559575 "the statement (1) has no open cursor" pops sometimes with
--echo # prepared+query_cache
--echo #
--echo # Create relevent tables and call C API test cases
--echo # Setup

#Set query_cache_size to 1MB
SET @save_query_cache_size = @@query_cache_size;
SET GLOBAL query_cache_size = 1048576;

select VARIABLE_VALUE into @qcache_hit_val1 from
  performance_schema.global_status where VARIABLE_NAME = 'Qcache_hits';

--echo
--echo #Run C_API test case
--exec echo "$MYSQL_CLIENT_TEST --silent test_bug22559575" > $MYSQLTEST_VARDIR/log/mysql_client_test_qcache.out.log 2>&1
--exec $MYSQL_CLIENT_TEST --silent test_bug22559575 >> $MYSQLTEST_VARDIR/log/mysql_client_test_qcache.out.log 2>&1

select VARIABLE_VALUE into @qcache_hit_val2 from
  performance_schema.global_status where VARIABLE_NAME = 'Qcache_hits';
SELECT @qcache_hit_val2 - @qcache_hit_val1;

SET GLOBAL query_cache_size = @save_query_cache_size;
