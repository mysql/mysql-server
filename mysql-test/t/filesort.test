
--echo #
--echo # Bug#24709595 WL#8741: ASSERTION `SORTORDER->NEED_STRXNFRM == 0' FAILED
--echo #

CREATE TABLE t1(
  c VARCHAR(10) CHARACTER SET utf8 DEFAULT NULL
);
CREATE TABLE t2(
  c1 VARCHAR(255) CHARACTER SET utf8 DEFAULT NULL,
  c2 VARCHAR(10) CHARACTER SET utf8 DEFAULT NULL
);

INSERT INTO t1 VALUES('x');
INSERT INTO t2 VALUES('g','if'), ('not','ojgygqcgqi');

SELECT * FROM t2 WHERE (c2) <> (SELECT MAX(c) FROM t1 GROUP BY c1);

DROP TABLE t1, t2;

--echo #
--echo # Bug#29660945: SIG 6 AT TEMPTABLE::HANDLER::POSITION | SRC/HANDLER.CC
--echo #

SET optimizer_switch='block_nested_loop=off';

CREATE TABLE t1 (
  f1 varchar(255),
  f2 varchar(255)
);

INSERT INTO t1 VALUES (NULL,'A');
INSERT INTO t1 VALUES ('A',NULL);

SELECT * FROM t1 AS alias1 JOIN t1 AS alias2 ON alias1.f1=alias2.f2 ORDER BY alias2.f1 LIMIT 50;

DROP TABLE t1;

SET optimizer_switch=DEFAULT;

# Verify that we can sort data with large blobs (larger than the sort buffer).

SET sort_buffer_size=32768;

CREATE TABLE t1 (
  f1 INTEGER,
  f2 LONGBLOB
);

INSERT INTO t1 VALUES ( 2, REPEAT('-', 1048576) );
INSERT INTO t1 VALUES ( 1, REPEAT('x', 1048576) );

--replace_regex /(.){1024}/\1{1024}/
SELECT * FROM t1 ORDER BY f1;

DROP TABLE t1;
SET sort_buffer_size=DEFAULT;
