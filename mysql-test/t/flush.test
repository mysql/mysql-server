connect (con1,localhost,root,,test,0,mysql-master.sock);
connect (con2,localhost,root,,test,0,mysql-master.sock);
connection con1;
drop table if exists t1;
create temporary table t1(n int not null primary key);
drop table if exists t2;
create table t2(n int);
insert into t2 values(3);
let $1=100;
while ($1)
{
 connection con1;
 send replace into t1 select n from t2;
 connection con2;
 send flush tables;
 connection con1;
 reap;
 connection con2;
 reap;
 dec $1;
}

connection con1;
select * from t1;
drop table t2;
