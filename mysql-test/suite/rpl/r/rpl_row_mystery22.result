stop slave;
drop table if exists t1,t2,t3,t4,t5,t6,t7,t8,t9;
reset master;
reset slave;
drop table if exists t1,t2,t3,t4,t5,t6,t7,t8,t9;
start slave;
create table t1(n int auto_increment primary key, s char(10));
set @@global.slave_exec_mode= 'IDEMPOTENT';
insert into t1 values (2,'old');
insert into t1 values(NULL,'new');
insert into t1 values(NULL,'new');
select * from t1 order by n;
n	s
1	new
2	new
delete from t1 where n = 2;
start slave;
stop slave;
create table t2(n int);
drop table t2;
insert into t1 values(NULL,'new');
set sql_log_bin=0;
insert into t1 values(NULL,'new');
set sql_log_bin=1;
delete from t1 where n=4;
start slave;
select * from t1 order by n;
n	s
1	new
3	new
drop table t1;
set @@global.slave_exec_mode= default;
