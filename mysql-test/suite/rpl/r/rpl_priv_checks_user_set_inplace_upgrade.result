#
# TC1. Upgrade from FILE to TABLE with PRIVILEGE_CHECKS_USER configured
# ---------------------------------------------------------------------
#
include/master-slave.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the master info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START SLAVE; see the 'START SLAVE Syntax' in the MySQL Manual for more information.
[connection master]
[connection slave]
GRANT CREATE,INSERT,DROP ON *.* TO 'u1'@'localhost';
include/start_slave.inc
[connection master]
CREATE TABLE t (c INT);
INSERT INTO t VALUES (1), (2);
include/sync_slave_sql_with_master.inc
include/stop_slave.inc
ALTER TABLE mysql.slave_relay_log_info DROP COLUMN Privilege_checks_username;
ALTER TABLE mysql.slave_relay_log_info DROP COLUMN Privilege_checks_hostname;
include/assert.inc [Configured PRIVILEGE_CHECKS_USER appears in PFS table]
include/assert.inc [Table mysql.slave_relay_log_info has no information since --relay-log-info-repository=FILE]
include/assert.inc [Table mysql.slave_relay_log_info has no columns regarding PRIVILEGE_CHECKS_USER]
include/rpl_stop_server.inc [server_number=2]
include/rpl_start_server.inc [server_number=2 parameters: --relay-log-info-repository=TABLE --upgrade=FORCE]
include/start_slave.inc
[connection slave]
include/assert.inc [Table mysql.slave_relay_log_info has columns for PRIVILEGE_CHECKS_USER]
include/assert.inc [Table mysql.slave_relay_log_info has info for channel and PRIVILEGE_CHECKS_USER since --relay-log-info-repository=TABLE]
include/stop_slave.inc
CHANGE REPLICATION SOURCE TO PRIVILEGE_CHECKS_USER = NULL;
include/start_slave.inc
include/assert.inc [Table mysql.slave_relay_log_info has info for channel and PRIVILEGE_CHECKS_USER = NULL]
[connection master]
DROP TABLE t;
include/sync_slave_sql_with_master.inc
include/stop_slave.inc
SET GLOBAL relay_log_info_repository="FILE";
Warnings:
Warning	1287	'@@relay_log_info_repository' is deprecated and will be removed in a future release.
include/start_slave.inc
include/rpl_end.inc
