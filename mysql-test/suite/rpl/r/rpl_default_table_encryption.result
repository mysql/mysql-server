include/master-slave.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the master info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START SLAVE; see the 'START SLAVE Syntax' in the MySQL Manual for more information.
[connection master]
#### SETUP ####
[connection master]
SET @default_table_encryption_save = @@global.default_table_encryption;
CALL mtr.add_suppression("Could not flush keys to keyring's backup");
CALL mtr.add_suppression("Incorrect Keyring File");
include/sync_slave_sql_with_master.inc
SET @default_table_encryption_save = @@global.default_table_encryption;
#### TEST ####
[connection master]
SET @@global.default_table_encryption = 0;
[connection slave]
SET @@global.default_table_encryption = 0;
[connection master]
SET @@session.default_table_encryption = 0;
==== CREATE DATABASE db [master_session:0 master_global:0 slave_global:0] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=0]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-0;
==== ALTER DATABASE db CHARACTER SET = utf8 [master_session:0 master_global:0 slave_global:0] ====
# ALTER: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER DATABASE db CHARACTER SET = utf8;
Warnings:
Warning	3719	'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 0;
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'n' [master_session:0 master_global:0 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'y' [master_session:0 master_global:0 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts [master_session:0 master_global:0 slave_global:0] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=0]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-0;
==== ALTER TABLESPACE ts RENAME TO ts2 [master_session:0 master_global:0 slave_global:0] ====
# ALTER should not include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER TABLESPACE ts RENAME TO ts2;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
DROP TABLESPACE ts2;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 0;
==== CREATE TABLESPACE ts ENCRYPTION = 'y' [master_session:0 master_global:0 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts ENCRYPTION = 'n' [master_session:0 master_global:0 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
[connection master]
SET @@session.default_table_encryption = 1;
==== CREATE DATABASE db [master_session:1 master_global:0 slave_global:0] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=1]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-1;
==== ALTER DATABASE db CHARACTER SET = utf8 [master_session:1 master_global:0 slave_global:0] ====
# ALTER: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER DATABASE db CHARACTER SET = utf8;
Warnings:
Warning	3719	'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1;
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'n' [master_session:1 master_global:0 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'y' [master_session:1 master_global:0 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts [master_session:1 master_global:0 slave_global:0] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=1]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-1;
==== ALTER TABLESPACE ts RENAME TO ts2 [master_session:1 master_global:0 slave_global:0] ====
# ALTER should not include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER TABLESPACE ts RENAME TO ts2;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
DROP TABLESPACE ts2;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1;
==== CREATE TABLESPACE ts ENCRYPTION = 'y' [master_session:1 master_global:0 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts ENCRYPTION = 'n' [master_session:1 master_global:0 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
[connection slave]
SET @@global.default_table_encryption = 1;
[connection master]
SET @@session.default_table_encryption = 0;
==== CREATE DATABASE db [master_session:0 master_global:0 slave_global:1] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=0]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-0;
==== ALTER DATABASE db CHARACTER SET = utf8 [master_session:0 master_global:0 slave_global:1] ====
# ALTER: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER DATABASE db CHARACTER SET = utf8;
Warnings:
Warning	3719	'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 0;
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'n' [master_session:0 master_global:0 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'y' [master_session:0 master_global:0 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts [master_session:0 master_global:0 slave_global:1] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=0]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-0;
==== ALTER TABLESPACE ts RENAME TO ts2 [master_session:0 master_global:0 slave_global:1] ====
# ALTER should not include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER TABLESPACE ts RENAME TO ts2;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
DROP TABLESPACE ts2;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 0;
==== CREATE TABLESPACE ts ENCRYPTION = 'y' [master_session:0 master_global:0 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts ENCRYPTION = 'n' [master_session:0 master_global:0 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
[connection master]
SET @@session.default_table_encryption = 1;
==== CREATE DATABASE db [master_session:1 master_global:0 slave_global:1] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=1]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-1;
==== ALTER DATABASE db CHARACTER SET = utf8 [master_session:1 master_global:0 slave_global:1] ====
# ALTER: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER DATABASE db CHARACTER SET = utf8;
Warnings:
Warning	3719	'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1;
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'n' [master_session:1 master_global:0 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'y' [master_session:1 master_global:0 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts [master_session:1 master_global:0 slave_global:1] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=1]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-1;
==== ALTER TABLESPACE ts RENAME TO ts2 [master_session:1 master_global:0 slave_global:1] ====
# ALTER should not include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER TABLESPACE ts RENAME TO ts2;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
DROP TABLESPACE ts2;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1;
==== CREATE TABLESPACE ts ENCRYPTION = 'y' [master_session:1 master_global:0 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts ENCRYPTION = 'n' [master_session:1 master_global:0 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
[connection master]
SET @@global.default_table_encryption = 1;
[connection slave]
SET @@global.default_table_encryption = 0;
[connection master]
SET @@session.default_table_encryption = 0;
==== CREATE DATABASE db [master_session:0 master_global:1 slave_global:0] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=0]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-0;
==== ALTER DATABASE db CHARACTER SET = utf8 [master_session:0 master_global:1 slave_global:0] ====
# ALTER: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER DATABASE db CHARACTER SET = utf8;
Warnings:
Warning	3719	'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 0;
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'n' [master_session:0 master_global:1 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'y' [master_session:0 master_global:1 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts [master_session:0 master_global:1 slave_global:0] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=0]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-0;
==== ALTER TABLESPACE ts RENAME TO ts2 [master_session:0 master_global:1 slave_global:0] ====
# ALTER should not include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER TABLESPACE ts RENAME TO ts2;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
DROP TABLESPACE ts2;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 0;
==== CREATE TABLESPACE ts ENCRYPTION = 'y' [master_session:0 master_global:1 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts ENCRYPTION = 'n' [master_session:0 master_global:1 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
[connection master]
SET @@session.default_table_encryption = 1;
==== CREATE DATABASE db [master_session:1 master_global:1 slave_global:0] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=1]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-1;
==== ALTER DATABASE db CHARACTER SET = utf8 [master_session:1 master_global:1 slave_global:0] ====
# ALTER: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER DATABASE db CHARACTER SET = utf8;
Warnings:
Warning	3719	'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1;
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'n' [master_session:1 master_global:1 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'y' [master_session:1 master_global:1 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts [master_session:1 master_global:1 slave_global:0] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=1]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-1;
==== ALTER TABLESPACE ts RENAME TO ts2 [master_session:1 master_global:1 slave_global:0] ====
# ALTER should not include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER TABLESPACE ts RENAME TO ts2;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
DROP TABLESPACE ts2;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1;
==== CREATE TABLESPACE ts ENCRYPTION = 'y' [master_session:1 master_global:1 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts ENCRYPTION = 'n' [master_session:1 master_global:1 slave_global:0] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
[connection slave]
SET @@global.default_table_encryption = 1;
[connection master]
SET @@session.default_table_encryption = 0;
==== CREATE DATABASE db [master_session:0 master_global:1 slave_global:1] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=0]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-0;
==== ALTER DATABASE db CHARACTER SET = utf8 [master_session:0 master_global:1 slave_global:1] ====
# ALTER: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER DATABASE db CHARACTER SET = utf8;
Warnings:
Warning	3719	'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 0;
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'n' [master_session:0 master_global:1 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'y' [master_session:0 master_global:1 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts [master_session:0 master_global:1 slave_global:1] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=0]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-0;
==== ALTER TABLESPACE ts RENAME TO ts2 [master_session:0 master_global:1 slave_global:1] ====
# ALTER should not include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER TABLESPACE ts RENAME TO ts2;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
DROP TABLESPACE ts2;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 0;
==== CREATE TABLESPACE ts ENCRYPTION = 'y' [master_session:0 master_global:1 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts ENCRYPTION = 'n' [master_session:0 master_global:1 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
[connection master]
SET @@session.default_table_encryption = 1;
==== CREATE DATABASE db [master_session:1 master_global:1 slave_global:1] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=1]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-1;
==== ALTER DATABASE db CHARACTER SET = utf8 [master_session:1 master_global:1 slave_global:1] ====
# ALTER: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER DATABASE db CHARACTER SET = utf8;
Warnings:
Warning	3719	'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1;
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'n' [master_session:1 master_global:1 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='N'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='N'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE DATABASE db DEFAULT ENCRYPTION = 'y' [master_session:1 master_global:1 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE DATABASE db DEFAULT ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "%ENCRYPTION='Y'%"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "%ENCRYPTION='Y'%"
[connection master]
DROP DATABASE db;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts [master_session:1 master_global:1 slave_global:1] ====
# CREATE without ENCRYPTION: include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should contain default_table_encryption=1]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1-1;
==== ALTER TABLESPACE ts RENAME TO ts2 [master_session:1 master_global:1 slave_global:1] ====
# ALTER should not include the variable in the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
ALTER TABLESPACE ts RENAME TO ts2;
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
DROP TABLESPACE ts2;
include/sync_slave_sql_with_master.inc
[connection master]
SET @@session.default_table_encryption = 1;
==== CREATE TABLESPACE ts ENCRYPTION = 'y' [master_session:1 master_global:1 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'y';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "Y"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "Y"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
==== CREATE TABLESPACE ts ENCRYPTION = 'n' [master_session:1 master_global:1 slave_global:1] ====
# CREATE with ENCRYPTION: exclude the variable from the binlog
[connection slave]
include/stop_slave_sql.inc
include/start_slave_sql.inc
[connection master]
include/save_binlog_position.inc
CREATE TABLESPACE ts ENCRYPTION = 'n';
# Assert that binlog is as expected
include/assert_grep.inc [Binlog should not contain default_table_encryption]
# Assert that object on master is "N"
include/sync_slave_sql_with_master.inc
# Assert that object on slave is "N"
[connection master]
DROP TABLESPACE ts;
include/sync_slave_sql_with_master.inc
[connection master]
#### CLEANUP ####
[connection master]
SET @@global.default_table_encryption = @default_table_encryption_save;
[connection slave]
SET @@global.default_table_encryption = @default_table_encryption_save;
include/rpl_end.inc
