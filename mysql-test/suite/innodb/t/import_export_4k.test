
let $MYSQLD_DATADIR =`SELECT @@datadir`;

--echo #
--echo # Bug#21341030 - IMPORT TABLESPACE HITS DEBUG ASSERTION WHEN
--echo #                USING 4K AND ROW_FORMAT=DYNAMIC

CREATE TABLE t1 (c1 INT, c2 BLOB, c3 BLOB) ENGINE=InnoDB
ROW_FORMAT=DYNAMIC;

INSERT INTO t1 VALUES(100, REPEAT('abcdef', 899), REPEAT('ghijklmn', 4800));

INSERT INTO t1 SELECT * FROM t1;
INSERT INTO t1 SELECT * FROM t1;
INSERT INTO t1 SELECT * FROM t1;
INSERT INTO t1 SELECT * FROM t1;
INSERT INTO t1 SELECT * FROM t1;
INSERT INTO t1 SELECT * FROM t1;
INSERT INTO t1 SELECT * FROM t1;
INSERT INTO t1 SELECT * FROM t1;

FLUSH TABLES t1 FOR EXPORT;
--copy_file $MYSQLD_DATADIR/test/t1.ibd $MYSQLD_DATADIR/test/t1b.ibd
--copy_file $MYSQLD_DATADIR/test/t1.cfg $MYSQLD_DATADIR/test/t1b.cfg
UNLOCK TABLES;

ALTER TABLE t1 DISCARD TABLESPACE;
--move_file $MYSQLD_DATADIR/test/t1b.ibd $MYSQLD_DATADIR/test/t1.ibd
--move_file $MYSQLD_DATADIR/test/t1b.cfg $MYSQLD_DATADIR/test/t1.cfg

ALTER TABLE t1 IMPORT TABLESPACE;
CHECK TABLE t1;
DROP TABLE t1;
