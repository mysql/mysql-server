CREATE TABLE t (
`c0000` INT NOT NULL,
`c0003` TINYINT NOT NULL,
`c0004` INT NOT NULL,
PRIMARY KEY (`c0000`,`c0003`,`c0004`)
)
PARTITION BY KEY (c0003) PARTITIONS 6;
INSERT INTO t VALUES (123,12,0);
INSERT INTO t VALUES (122,13,0);
BEGIN;
SELECT * FROM t WHERE `c0000` = 122 AND `c0003` = 13 FOR UPDATE;
c0000	c0003	c0004
122	13	0
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
BEGIN;
UPDATE t SET `c0003` = 16 WHERE `c0004`;
COMMIT;
COMMIT;
DROP TABLE t;
CREATE TABLE t (
`c0000` INT NOT NULL,
`c0003` TINYINT NOT NULL,
`c0004` INT NOT NULL,
PRIMARY KEY (`c0000`,`c0003`,`c0004`)
)
PARTITION BY KEY (c0003) PARTITIONS 6;
INSERT INTO t VALUES (121,13,0);
INSERT INTO t VALUES (123,12,0);
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
BEGIN;
SELECT * FROM t WHERE `c0000` = 121 AND `c0003` = 13 AND `c0004` = 0 FOR UPDATE;
c0000	c0003	c0004
121	13	0
SELECT LOCK_DATA
FROM performance_schema.data_locks
WHERE LOCK_TYPE = 'RECORD' AND OBJECT_NAME = 't';
LOCK_DATA
121, 13, 0
UPDATE t SET `c0003` = 16 WHERE `c0004`;
SELECT LOCK_DATA
FROM performance_schema.data_locks
WHERE LOCK_TYPE = 'RECORD' AND OBJECT_NAME = 't';
LOCK_DATA
121, 13, 0
COMMIT;
DROP TABLE t;
CREATE TABLE t (
`c0000` INT NOT NULL,
`c0003` TINYINT NOT NULL,
`c0004` INT NOT NULL,
PRIMARY KEY (`c0000`,`c0003`,`c0004`)
)
PARTITION BY KEY (c0003) PARTITIONS 6;
INSERT INTO t VALUES (1,10,0);
INSERT INTO t VALUES (2,11,0);
INSERT INTO t VALUES (4,13,0);
INSERT INTO t VALUES (5,14,0);
INSERT INTO t VALUES (6,15,0);
INSERT INTO t VALUES (7,16,0);
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
BEGIN;
SELECT LOCK_DATA
FROM performance_schema.data_locks
WHERE LOCK_TYPE = 'RECORD' AND OBJECT_NAME = 't';
LOCK_DATA
UPDATE t SET `c0003` = 16 WHERE `c0004`;
SELECT LOCK_DATA
FROM performance_schema.data_locks
WHERE LOCK_TYPE = 'RECORD' AND OBJECT_NAME = 't';
LOCK_DATA
COMMIT;
DROP TABLE t;
