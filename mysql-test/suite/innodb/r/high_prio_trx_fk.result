CREATE TABLE t1 (c1 INT PRIMARY KEY)ENGINE=INNODB;
CREATE TABLE t2 (c2 INT PRIMARY KEY,
FOREIGN KEY (c2) REFERENCES t1(c1))ENGINE=INNODB;
INSERT INTO t1 VALUES(1);
# On Connection 1
START TRANSACTION;
DELETE FROM t1 WHERE c1 = 1;
# On Connection 2
include/start_transaction_high_prio.inc
START TRANSACTION /* HIGH PRIORITY */;
INSERT INTO t2 VALUES(1);
COMMIT;
# On connection 1
COMMIT;
ERROR HY000: Got error 149 during COMMIT
DROP TABLE t2, t1;
CREATE TABLE t1 (c1 INT PRIMARY KEY)ENGINE=INNODB;
CREATE TABLE t2 (c2 INT PRIMARY KEY,
FOREIGN KEY (c2) REFERENCES t1(c1)
ON UPDATE CASCADE)ENGINE=INNODB;
INSERT INTO t1 VALUES(1);
# On Connection 1
START TRANSACTION;
UPDATE t1 SET C1=2 where C1 = 1;
# On Connection 2
include/start_transaction_high_prio.inc
START TRANSACTION /* HIGH PRIORITY */;
INSERT INTO t2 VALUES (1);
COMMIT;

# On connection 1
COMMIT;
ERROR HY000: Got error 149 during COMMIT
DROP TABLE t2, t1;
