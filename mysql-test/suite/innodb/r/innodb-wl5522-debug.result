SET GLOBAL innodb_file_per_table = 1;
SELECT @@innodb_file_per_table;
@@innodb_file_per_table
1
DROP DATABASE IF EXISTS test_wl5522;
Warnings:
Note	1008	Can't drop database 'test_wl5522'; database doesn't exist
CREATE DATABASE test_wl5522;
CREATE TABLE test_wl5522.t1 (c1 INT) ENGINE = Innodb;
INSERT INTO test_wl5522.t1 VALUES (100), (200), (300);
SELECT COUNT(*) FROM test_wl5522.t1;
COUNT(*)
3
FLUSH TABLES test_wl5522.t1 WITH READ LOCK;
backup: t1
UNLOCK TABLES;
DROP TABLE test_wl5522.t1;
CREATE TABLE test_wl5522.t1 (c1 INT) ENGINE = Innodb;
ALTER TABLE test_wl5522.t1 DISCARD TABLESPACE;
SELECT COUNT(*) FROM test_wl5522.t1;
ERROR HY000: Got error -1 from storage engine
SET SESSION debug="+d,ib_import_reset_space_and_lsn_failure";
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: InnoDB: Error opening: 't1.cfg'
restore: t1
SET SESSION debug="-d,ib_import_reset_space_and_lsn_failure";
SET SESSION debug="+d,ib_import_open_tablespace_failure";
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: InnoDB: Cannot open tablespace 't1.ibd' file of '"test_wl5522"."t1"' : Tablespace not found
restore: t1
SET SESSION debug="-d,ib_import_open_tablespace_failure";
SET SESSION debug="+d,ib_import_check_bitmap_failure";
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Incorrect key file for table 't1'; try to repair it
restore: t1
SET SESSION debug="-d,ib_import_check_bitmap_failure";
SET SESSION debug="+d,ib_import_cluster_root_adjust_failure";
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Incorrect key file for table 't1'; try to repair it
restore: t1
SET SESSION debug="-d,ib_import_cluster_root_adjust_failure";
SET SESSION debug="+d,ib_import_cluster_failure";
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Incorrect key file for table 't1'; try to repair it
restore: t1
SET SESSION debug="-d,ib_import_cluster_failure";
SET SESSION debug="+d,ib_import_sec_root_adjust_failure";
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Incorrect key file for table 't1'; try to repair it
restore: t1
SET SESSION debug="-d,ib_import_sec_root_adjust_failure";
SET SESSION debug="+d,ib_import_set_max_rowid_failure";
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Incorrect key file for table 't1'; try to repair it
restore: t1
SET SESSION debug="-d,ib_import_set_max_rowid_failure";
SET SESSION debug="+d,ib_import_before_commit_crash";
SELECT * FROM test_wl5522.t1;
ERROR HY000: Got error -1 from storage engine
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Lost connection to MySQL server during query
restore: t1
SET SESSION debug="-d,ib_import_before_commit_crash";
SET SESSION debug="+d,ib_import_after_commit_crash";
SELECT * FROM test_wl5522.t1;
ERROR HY000: Got error -1 from storage engine
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Lost connection to MySQL server during query
SET SESSION debug="-d,ib_import_after_commit_crash";
SET GLOBAL innodb_file_per_table = 1;
SELECT @@innodb_file_per_table;
@@innodb_file_per_table
1
SET SESSION debug="+d,ib_import_after_checkpoint_crash";
SELECT COUNT(*) FROM test_wl5522.t1;
COUNT(*)
3
ALTER TABLE test_wl5522.t1 DISCARD TABLESPACE;
restore: t1
SELECT COUNT(*) FROM test_wl5522.t1;
ERROR HY000: Got error -1 from storage engine
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
ERROR HY000: Lost connection to MySQL server during query
SET SESSION debug="-d,ib_import_after_checkpoint_crash";
SET GLOBAL innodb_file_per_table = 1;
SELECT @@innodb_file_per_table;
@@innodb_file_per_table
1
SELECT COUNT(*) FROM test_wl5522.t1;
COUNT(*)
3
ALTER TABLE test_wl5522.t1 DISCARD TABLESPACE;
restore: t1
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
SELECT COUNT(*) FROM test_wl5522.t1;
COUNT(*)
3
ALTER TABLE test_wl5522.t1 DISCARD TABLESPACE;
restore: t1
SELECT COUNT(*) FROM test_wl5522.t1;
ERROR HY000: Got error -1 from storage engine
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
SELECT COUNT(*) FROM test_wl5522.t1;
COUNT(*)
3
INSERT INTO test_wl5522.t1 VALUES(400), (500), (600);
SELECT * FROM test_wl5522.t1;
c1
100
200
300
400
500
600
DROP TABLE test_wl5522.t1;
CREATE TABLE test_wl5522.t1 (
c1 BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
c2 BIGINT,
c3 VARCHAR(2048),
c4 VARCHAR(2048),
INDEX idx1(c2),
INDEX idx2(c3(512)),
INDEX idx3(c4(512))) Engine=InnoDB;
SET SESSION debug="+d,ib_buf_force_flush";
SET SESSION debug="+d,ib_ibuf_background_disable";
INSERT INTO test_wl5522.t1(c2, c3, c4) VALUES
(1, REPEAT('a', 2048), REPEAT('a', 2048)),
(2, REPEAT('b', 2048), REPEAT('b', 2048)),
(3, REPEAT('c', 2048), REPEAT('c', 2048)),
(4, REPEAT('d', 2048), REPEAT('d', 2048));
INSERT INTO test_wl5522.t1(c2, c3, c4) SELECT c2, c3, c4 FROM test_wl5522.t1;
INSERT INTO test_wl5522.t1(c2, c3, c4) SELECT c2, c3, c4 FROM test_wl5522.t1;
INSERT INTO test_wl5522.t1(c2, c3, c4) SELECT c2, c3, c4 FROM test_wl5522.t1;
INSERT INTO test_wl5522.t1(c2, c3, c4) SELECT c2, c3, c4 FROM test_wl5522.t1;
INSERT INTO test_wl5522.t1(c2, c3, c4) SELECT c2, c3, c4 FROM test_wl5522.t1;
SET GLOBAL INNODB_PURGE_STOP_NOW=ON;
DELETE FROM test_wl5522.t1 WHERE c2 = 1;
UPDATE test_wl5522.t1 SET c2 = c2 + c1;
UPDATE test_wl5522.t1 SET c2 = c2 + c1;
UPDATE test_wl5522.t1 SET c2 = c2 + c1;
UPDATE test_wl5522.t1 SET c2 = c2 + c1;
UPDATE test_wl5522.t1 SET c2 = c2 + c1;
UPDATE test_wl5522.t1 SET c2 = c2 + c1;
UPDATE test_wl5522.t1 SET c2 = c2 + c1;
UPDATE test_wl5522.t1 SET c2 = c2 + c1;
UPDATE test_wl5522.t1 SET c2 = c2 + c1;
UPDATE test_wl5522.t1 SET c2 = c2 + c1;
UPDATE test_wl5522.t1 SET c2 = c2 + c1;
UPDATE test_wl5522.t1 SET c2 = c2 + c1;
UPDATE test_wl5522.t1 SET c2 = c2 + c1;
UPDATE test_wl5522.t1 SET c2 = c2 + c1;
UPDATE test_wl5522.t1 SET c2 = c2 + c1;
UPDATE test_wl5522.t1 SET c3 = REPEAT("c2", 1024);
UPDATE test_wl5522.t1 SET c4 = REPEAT("c4", 1024);
SHOW CREATE TABLE test_wl5522.t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `c1` bigint(20) NOT NULL AUTO_INCREMENT,
  `c2` bigint(20) DEFAULT NULL,
  `c3` varchar(2048) DEFAULT NULL,
  `c4` varchar(2048) DEFAULT NULL,
  PRIMARY KEY (`c1`),
  KEY `idx1` (`c2`),
  KEY `idx2` (`c3`(512)),
  KEY `idx3` (`c4`(512))
) ENGINE=InnoDB AUTO_INCREMENT=248 DEFAULT CHARSET=latin1
SELECT c1, c2 FROM test_wl5522.t1;
c1	c2
2	32
3	48
4	64
6	92
7	108
8	124
13	197
14	213
15	229
17	257
18	273
19	289
28	422
29	438
30	454
32	482
33	498
34	514
36	542
37	558
38	574
40	602
41	618
42	634
59	887
60	903
61	919
63	947
64	963
65	979
67	1007
68	1023
69	1039
71	1067
72	1083
73	1099
75	1127
76	1143
77	1159
79	1187
80	1203
81	1219
83	1247
84	1263
85	1279
87	1307
88	1323
89	1339
122	1832
123	1848
124	1864
126	1892
127	1908
128	1924
130	1952
131	1968
132	1984
134	2012
135	2028
136	2044
138	2072
139	2088
140	2104
142	2132
143	2148
144	2164
146	2192
147	2208
148	2224
150	2252
151	2268
152	2284
154	2312
155	2328
156	2344
158	2372
159	2388
160	2404
162	2432
163	2448
164	2464
166	2492
167	2508
168	2524
170	2552
171	2568
172	2584
174	2612
175	2628
176	2644
178	2672
179	2688
180	2704
182	2732
183	2748
184	2764
SELECT COUNT(*) FROM test_wl5522.t1;
COUNT(*)
96
SELECT SUM(c2) FROM test_wl5522.t1;
SUM(c2)
145278
FLUSH TABLES test_wl5522.t1 WITH READ LOCK;
backup: t1
UNLOCK TABLES;
SET GLOBAL INNODB_PURGE_RUN_NOW=ON;
DROP TABLE test_wl5522.t1;
CREATE TABLE test_wl5522.t1 (
c1 BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
c2 BIGINT,
c3 VARCHAR(2048),
c4 VARCHAR(2048),
INDEX idx1(c2),
INDEX idx2(c3(512)),
INDEX idx3(c4(512))) Engine=InnoDB;
SELECT c1, c2 FROM test_wl5522.t1;
c1	c2
ALTER TABLE test_wl5522.t1 DISCARD TABLESPACE;
restore: t1
ALTER TABLE test_wl5522.t1 IMPORT TABLESPACE;
CHECK TABLE test_wl5522.t1;
Table	Op	Msg_type	Msg_text
test_wl5522.t1	check	status	OK
SELECT c1,c2 FROM test_wl5522.t1;
c1	c2
2	32
3	48
4	64
6	92
7	108
8	124
13	197
14	213
15	229
17	257
18	273
19	289
28	422
29	438
30	454
32	482
33	498
34	514
36	542
37	558
38	574
40	602
41	618
42	634
59	887
60	903
61	919
63	947
64	963
65	979
67	1007
68	1023
69	1039
71	1067
72	1083
73	1099
75	1127
76	1143
77	1159
79	1187
80	1203
81	1219
83	1247
84	1263
85	1279
87	1307
88	1323
89	1339
122	1832
123	1848
124	1864
126	1892
127	1908
128	1924
130	1952
131	1968
132	1984
134	2012
135	2028
136	2044
138	2072
139	2088
140	2104
142	2132
143	2148
144	2164
146	2192
147	2208
148	2224
150	2252
151	2268
152	2284
154	2312
155	2328
156	2344
158	2372
159	2388
160	2404
162	2432
163	2448
164	2464
166	2492
167	2508
168	2524
170	2552
171	2568
172	2584
174	2612
175	2628
176	2644
178	2672
179	2688
180	2704
182	2732
183	2748
184	2764
SELECT COUNT(*) FROM test_wl5522.t1;
COUNT(*)
96
SELECT SUM(c2) FROM test_wl5522.t1;
SUM(c2)
145278
SHOW CREATE TABLE test_wl5522.t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `c1` bigint(20) NOT NULL AUTO_INCREMENT,
  `c2` bigint(20) DEFAULT NULL,
  `c3` varchar(2048) DEFAULT NULL,
  `c4` varchar(2048) DEFAULT NULL,
  PRIMARY KEY (`c1`),
  KEY `idx1` (`c2`),
  KEY `idx2` (`c3`(512)),
  KEY `idx3` (`c4`(512))
) ENGINE=InnoDB AUTO_INCREMENT=185 DEFAULT CHARSET=latin1
DROP TABLE test_wl5522.t1;
DROP DATABASE test_wl5522;
SELECT name, count 
FROM information_schema.innodb_metrics
WHERE name = 'ibuf_page_merges';
name	count
ibuf_page_merges	48
SET SESSION debug="-d,ib_buf_force_flush";
SET SESSION debug="-d,ib_ibuf_disable_background_merge";
