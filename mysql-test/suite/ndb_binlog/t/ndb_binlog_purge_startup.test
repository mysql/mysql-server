-- source include/have_ndb.inc
-- source include/have_binlog_format_mixed_or_row.inc
-- source include/have_debug.inc

show variables like 'log_bin';

reset binary logs and gtids;

use test;
create table stuff (a int) engine=ndb;

--echo File 1
insert into stuff values (1);
flush logs;

--echo File 2
insert into stuff values (1);
flush logs;

--echo File 3
insert into stuff values (1);
flush logs;

--echo File 4
insert into stuff values (1);
flush logs;

--echo File 5
insert into stuff values (1);
flush logs;

#show binary logs;
#select distinct(file) from mysql.ndb_binlog_index;

# Ignore the warning generated by ndbcluster's binlog thread
# when mysqld is restarted
--disable_query_log ONCE
call mtr.add_suppression("mysqld startup An incident event has been written");

--echo Now restart, should re-pickup the expire-log-days
--echo debug setting from the config file, and perform
--echo expire-logs action at restart...
let $mysqld_name=mysqld.1.1;
--source include/restart_mysqld.inc

--disable_result_log
--disable_query_log
--source include/ndb_not_readonly.inc
--enable_result_log
--enable_query_log

#show binary logs;
#select distinct(file) from mysql.ndb_binlog_index;

drop table stuff;
reset binary logs and gtids;

