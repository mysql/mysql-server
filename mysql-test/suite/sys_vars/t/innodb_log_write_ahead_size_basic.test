
SET @start_global_value = @@global.innodb_log_write_ahead_size;

# default value is limited by innodb_page_size and varying along with the page size.
#SELECT @start_global_value;

#set common valid value
SET global innodb_log_write_ahead_size=4096;

#
# exists as global only
#
--echo Valid values are positive number
SELECT @@global.innodb_log_write_ahead_size >= 512;
SELECT @@global.innodb_log_write_ahead_size <= 16*1024;

--error ER_INCORRECT_GLOBAL_LOCAL_VAR
SELECT @@session.innodb_log_write_ahead_size;
SHOW global variables LIKE 'innodb_log_write_ahead_size';
SHOW session variables LIKE 'innodb_log_write_ahead_size';
--disable_warnings
SELECT * FROM performance_schema.global_variables
WHERE variable_name='innodb_log_write_ahead_size';
SELECT * FROM performance_schema.session_variables
WHERE variable_name='innodb_log_write_ahead_size';
--enable_warnings

#
# show that it's writable
#
SET global innodb_log_write_ahead_size=1024;
SELECT @@global.innodb_log_write_ahead_size;
--disable_warnings
SELECT * FROM performance_schema.global_variables
WHERE variable_name='innodb_log_write_ahead_size';
SELECT * FROM performance_schema.session_variables
WHERE variable_name='innodb_log_write_ahead_size';
--enable_warnings
--error ER_GLOBAL_VARIABLE
SET session innodb_log_write_ahead_size=2048;

#
# Valid values
#
SET global innodb_log_write_ahead_size=512;
SELECT @@global.innodb_log_write_ahead_size;
SET global innodb_log_write_ahead_size=2048;
SELECT @@global.innodb_log_write_ahead_size;
SET global innodb_log_write_ahead_size=4096;
SELECT @@global.innodb_log_write_ahead_size;

# limited by innodb_page_size, and the followings are occationally invalid
#SET global innodb_log_write_ahead_size=8192;
#SELECT @@global.innodb_log_write_ahead_size;
#SET global innodb_log_write_ahead_size=16384;
#SELECT @@global.innodb_log_write_ahead_size;

#
# Invalid values
#
SET global innodb_log_write_ahead_size=0;
SELECT @@global.innodb_log_write_ahead_size;
SET global innodb_log_write_ahead_size=-1024;
SELECT @@global.innodb_log_write_ahead_size;
SET global innodb_log_write_ahead_size=3000;
SELECT @@global.innodb_log_write_ahead_size;

# limited by innodb_page_size, and the followings result occationally different
#SET global innodb_log_write_ahead_size=32768;
#SELECT @@global.innodb_log_write_ahead_size;

#
# incorrect types
#
--error ER_WRONG_TYPE_FOR_VAR
SET global innodb_log_write_ahead_size=1.1;
--error ER_WRONG_TYPE_FOR_VAR
SET global innodb_log_write_ahead_size=1e1;
--error ER_WRONG_TYPE_FOR_VAR
SET global innodb_log_write_ahead_size="foo";
SET global innodb_log_write_ahead_size=-7;
SELECT @@global.innodb_log_write_ahead_size;
--disable_warnings
SELECT * FROM performance_schema.global_variables
WHERE variable_name='innodb_log_write_ahead_size';
--enable_warnings

#
# cleanup
#

SET @@global.innodb_log_write_ahead_size = @start_global_value;
