"MySQL Server 1"
CREATE LOGFILE GROUP lg1
ADD UNDOFILE 'lg1_undofile.dat'
  INITIAL_SIZE 1M
UNDO_BUFFER_SIZE = 1M
ENGINE=NDB;
CREATE TABLESPACE ts1
ADD DATAFILE 'ts1_datafile.dat'
  USE LOGFILE GROUP lg1
INITIAL_SIZE 2M
ENGINE NDB;
CREATE TABLESPACE ts2
ADD DATAFILE 'ts2_datafile.dat'
  USE LOGFILE GROUP lg1
INITIAL_SIZE 2M
ENGINE NDB;
CREATE TABLESPACE ts3
ADD DATAFILE 'ts3_datafile.dat'
  USE LOGFILE GROUP lg1
INITIAL_SIZE 2M
ENGINE NDB;
"Start Backup"
ALTER TABLESPACE ts1
DROP DATAFILE 'ts1_datafile.dat';
DROP TABLESPACE ts1;
ALTER TABLESPACE ts2
DROP DATAFILE 'ts2_datafile.dat';
DROP TABLESPACE ts2;
ALTER TABLESPACE ts3
DROP DATAFILE 'ts3_datafile.dat';
DROP TABLESPACE ts3;
DROP LOGFILE GROUP lg1
ENGINE=NDB;
"Restore backup"
# restart
# restart
CREATE LOGFILE GROUP lg1
ADD UNDOFILE 'lg1_undofile.dat'
  INITIAL_SIZE 1M
UNDO_BUFFER_SIZE = 1M
ENGINE=NDB;
ERROR HY000: Failed to create LOGFILE GROUP
SHOW WARNINGS;
Level	Code	Message
Warning	1296	Got error 721 'Schema object with given name already exists' from NDB
Warning	1296	Failed to create logfile group 'lg1' in NDB
Error	1528	Failed to create LOGFILE GROUP
CREATE TABLESPACE ts1
ADD DATAFILE 'ts1_datafile.dat'
  USE LOGFILE GROUP lg1
INITIAL_SIZE 2M
ENGINE NDB;
ERROR HY000: Tablespace 'ts1' exists.
CREATE TABLESPACE ts2
ADD DATAFILE 'ts2_datafile.dat'
  USE LOGFILE GROUP lg1
INITIAL_SIZE 2M
ENGINE NDB;
ERROR HY000: Tablespace 'ts2' exists.
CREATE TABLESPACE ts3
ADD DATAFILE 'ts3_datafile.dat'
  USE LOGFILE GROUP lg1
INITIAL_SIZE 2M
ENGINE NDB;
ERROR HY000: Tablespace 'ts3' exists.
ALTER TABLESPACE ts1
DROP DATAFILE 'ts1_datafile.dat';
DROP TABLESPACE ts1;
CREATE TABLESPACE ts1
ADD DATAFILE 'ts1_datafile.dat'
  USE LOGFILE GROUP lg1
INITIAL_SIZE 2M
ENGINE NDB;
ALTER TABLESPACE ts2
ADD DATAFILE 'ts2_datafile2.dat';
ALTER TABLESPACE ts3
ADD DATAFILE 'ts3_datafile2.dat';
ALTER TABLESPACE ts3
DROP DATAFILE 'ts3_datafile.dat';
ALTER LOGFILE GROUP lg1
ADD UNDOFILE 'lg1_undofile2.dat'
  ENGINE=NDB;
"MySQL Server 2 after reconnect"
CREATE TABLESPACE ts1
ADD DATAFILE 'ts1_datafile.dat'
  USE LOGFILE GROUP lg1
INITIAL_SIZE 2M
ENGINE NDB;
ERROR HY000: Tablespace 'ts1' exists.
ALTER TABLESPACE ts2
ADD DATAFILE 'ts2_datafile2.dat';
ERROR HY000: Failed to alter: CREATE DATAFILE FAILED
SHOW WARNINGS;
Level	Code	Message
Warning	1296	Got error 760 'File already exists' from NDB
Warning	1296	Failed to create datafile 'ts2_datafile2.dat' in NDB
Error	1533	Failed to alter: CREATE DATAFILE FAILED
ALTER TABLESPACE ts3
ADD DATAFILE 'ts3_datafile2.dat';
ERROR HY000: Failed to alter: CREATE DATAFILE FAILED
SHOW WARNINGS;
Level	Code	Message
Warning	1296	Got error 760 'File already exists' from NDB
Warning	1296	Failed to create datafile 'ts3_datafile2.dat' in NDB
Error	1533	Failed to alter: CREATE DATAFILE FAILED
ALTER TABLESPACE ts3
DROP DATAFILE 'ts3_datafile.dat';
ERROR HY000: Tablespace 'ts3' does not have a file named 'ts3_datafile.dat'
ALTER LOGFILE GROUP lg1
ADD UNDOFILE 'lg1_undofile2.dat'
  ENGINE=NDB;
ERROR HY000: Failed to alter: CREATE UNDOFILE FAILED
SHOW WARNINGS;
Level	Code	Message
Warning	1296	Got error 760 'File already exists' from NDB
Warning	1296	Failed to create undofile 'lg1_undofile2.dat' in NDB
Error	1533	Failed to alter: CREATE UNDOFILE FAILED
ALTER TABLESPACE ts1
DROP DATAFILE 'ts1_datafile.dat';
DROP TABLESPACE ts1;
ALTER TABLESPACE ts2
DROP DATAFILE 'ts2_datafile.dat';
ALTER TABLESPACE ts2
DROP DATAFILE 'ts2_datafile2.dat';
DROP TABLESPACE ts2;
ALTER TABLESPACE ts3
DROP DATAFILE 'ts3_datafile2.dat';
DROP TABLESPACE ts3;
DROP LOGFILE GROUP lg1
ENGINE=NDB;
"MySQL Server 1 after reconnect"
DROP TABLESPACE ts1;
ERROR HY000: Tablespace ts1 doesn't exist.
DROP TABLESPACE ts2;
ERROR HY000: Tablespace ts2 doesn't exist.
DROP TABLESPACE ts3;
ERROR HY000: Tablespace ts3 doesn't exist.
DROP LOGFILE GROUP lg1
ENGINE=NDB;
ERROR HY000: Failed to drop LOGFILE GROUP
SHOW WARNINGS;
Level	Code	Message
Warning	1296	Got error 723 'No such table existed' from NDB
Warning	1296	Failed to get logfile group 'lg1' from NDB
Error	1529	Failed to drop LOGFILE GROUP
CREATE LOGFILE GROUP lg1
ADD UNDOFILE 'lg1_undofile.dat'
  INITIAL_SIZE 1M
UNDO_BUFFER_SIZE = 1M
ENGINE NDB;
CREATE TABLESPACE ts1
ADD DATAFILE 'ts1_datafile.dat'
  USE LOGFILE GROUP lg1
INITIAL_SIZE 2M
ENGINE NDB;
CREATE TABLE t1 (
a INT PRIMARY KEY,
b VARCHAR(255)
) ENGINE NDB
TABLESPACE ts1
STORAGE DISK;
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) NOT NULL,
  `b` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`a`)
) /*!50100 TABLESPACE `ts1` STORAGE DISK */ ENGINE=ndbcluster DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
DROP TABLE t1;
ALTER TABLESPACE ts1
DROP DATAFILE 'ts1_datafile.dat';
DROP TABLESPACE ts1;
DROP LOGFILE GROUP lg1
ENGINE NDB;
# restart
# restart
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) NOT NULL,
  `b` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`a`)
) /*!50100 TABLESPACE `ts1` STORAGE DISK */ ENGINE=ndbcluster DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) NOT NULL,
  `b` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`a`)
) /*!50100 TABLESPACE `ts1` STORAGE DISK */ ENGINE=ndbcluster DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
INSERT INTO t1 VALUES(1,'a');
SELECT * FROM t1;
a	b
1	a
ALTER TABLE t1 DROP COLUMN b;
DROP TABLE t1;
ALTER TABLESPACE ts1
DROP DATAFILE 'ts1_datafile.dat';
DROP TABLESPACE ts1;
DROP LOGFILE GROUP lg1
ENGINE NDB;
