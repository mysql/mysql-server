DROP TABLE IF EXISTS t1,t2;
CREATE LOGFILE GROUP lg1
ADD UNDOFILE 'undofile.dat'
INITIAL_SIZE 16M
UNDO_BUFFER_SIZE = 1M ENGINE=NDB;
CREATE TABLESPACE ts1
ADD DATAFILE 'datafile.dat'
USE LOGFILE GROUP lg1
INITIAL_SIZE 64M
ENGINE NDB;
CREATE TABLE t1 (a int unsigned not null,
b int unsigned not null,
c int unsigned not null,
primary key(a,c),
unique (b))
ENGINE = NDB
COMMENT="NDB_TABLE=PARTITION_BALANCE=FOR_RP_BY_LDM"
partition by key(a);
-- t1 --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 3
Number of primary keys: 2
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 0
ForceVarPart: 1
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: DEFAULT-HASHMAP-3840-2
-- Attributes --
a Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
c Unsigned PRIMARY KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(a, c) - UniqueHashIndex
PRIMARY(a, c) - OrderedIndex
b(b) - OrderedIndex
b$unique(b) - UniqueHashIndex
-- t1/PRIMARY --
Version: Any
Base table: t1
Number of attributes: 2
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
a Unsigned NOT NULL AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/PRIMARY --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 3
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
a Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t1/b --
Version: Any
Base table: t1
Number of attributes: 1
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/b --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t1/b$unique --
Version: Any
Base table: t1
Number of attributes: 1
Logging: 1
Index type: UniqueHashIndex
Index status: Retrieved
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- IndexTable XX/b$unique --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: DEFAULT-HASHMAP-3840-2
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$PK Unsigned [3] NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(b) - UniqueHashIndex


NDBT_ProgramExit: 0 - OK

CREATE TABLE t2 (a int unsigned not null,
b int unsigned not null,
c int unsigned not null,
primary key(a,b),
unique (b))
ENGINE = NDB
COMMENT="NDB_TABLE=PARTITION_BALANCE=FOR_RP_BY_LDM"
STORAGE DISK
TABLESPACE ts1
partition by key(a);
-- t2 --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 3
Number of primary keys: 2
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 0
ForceVarPart: 1
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: DEFAULT-HASHMAP-3840-2
Tablespace id: XX
Tablespace: ts1
-- Attributes --
a Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned PRIMARY KEY AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=DISK
-- Indexes -- 
PRIMARY KEY(a, b) - UniqueHashIndex
PRIMARY(a, b) - OrderedIndex
b(b) - OrderedIndex
b$unique(b) - UniqueHashIndex
-- t2/PRIMARY --
Version: Any
Base table: t2
Number of attributes: 2
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
a Unsigned NOT NULL AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/PRIMARY --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 3
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
a Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t2/b --
Version: Any
Base table: t2
Number of attributes: 1
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/b --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t2/b$unique --
Version: Any
Base table: t2
Number of attributes: 1
Logging: 1
Index type: UniqueHashIndex
Index status: Retrieved
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- IndexTable XX/b$unique --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: DEFAULT-HASHMAP-3840-2
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$PK Unsigned [3] NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(b) - UniqueHashIndex


NDBT_ProgramExit: 0 - OK

CREATE TABLE t3 (a int unsigned not null,
b int unsigned not null,
c int unsigned not null,
primary key(a,b),
unique (b))
MAX_ROWS=50000000
ENGINE = NDB;
-- t3 --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 3
Number of primary keys: 2
Length of frm data: XXX
Max Rows: 50000000
Row Checksum: 1
Row GCI: 1
SingleUserMode: 0
ForceVarPart: 1
PartitionCount: 4
FragmentCount: 4
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: DEFAULT-HASHMAP-3840-4
-- Attributes --
a Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(a, b) - UniqueHashIndex
PRIMARY(a, b) - OrderedIndex
b(b) - OrderedIndex
b$unique(b) - UniqueHashIndex
-- t3/PRIMARY --
Version: Any
Base table: t3
Number of attributes: 2
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
a Unsigned NOT NULL AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/PRIMARY --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 3
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 4
FragmentCount: 4
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
a Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t3/b --
Version: Any
Base table: t3
Number of attributes: 1
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/b --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 4
FragmentCount: 4
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t3/b$unique --
Version: Any
Base table: t3
Number of attributes: 1
Logging: 1
Index type: UniqueHashIndex
Index status: Retrieved
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- IndexTable XX/b$unique --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 4
FragmentCount: 4
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: DEFAULT-HASHMAP-3840-4
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$PK Unsigned [3] NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(b) - UniqueHashIndex


NDBT_ProgramExit: 0 - OK

CREATE TABLE t4 (a int unsigned not null,
b int unsigned not null,
c int unsigned not null,
primary key(a,b),
unique (b))
ENGINE = NDB
COMMENT="NDB_TABLE=PARTITION_BALANCE=FOR_RP_BY_LDM";
CREATE TABLE t5 (a int unsigned not null,
b int unsigned not null,
c int unsigned null,
primary key(a,b),
unique (b),
unique (c))
ENGINE = NDB
partition by key(a) partitions 3;
Table: test.t1
PartitionCount: 2
FragmentCount: 2

b$unique(b) - UniqueHashIndex
FragmentCount: 2
Table: test.t2
PartitionCount: 2
FragmentCount: 2

b$unique(b) - UniqueHashIndex
FragmentCount: 2
Table: test.t3
PartitionCount: 4
FragmentCount: 4

b$unique(b) - UniqueHashIndex
FragmentCount: 4
Table: test.t4
PartitionCount: 2
FragmentCount: 2

b$unique(b) - UniqueHashIndex
FragmentCount: 2
Table: test.t5
PartitionCount: 3
FragmentCount: 3

b$unique(b) - UniqueHashIndex
FragmentCount: 3
c$unique(c) - UniqueHashIndex
FragmentCount: 3
INSERT INTO t1 VALUES
(1,1,1),(2,2,2),(3,3,3),(4,4,4),(5,5,5),
(6,6,6),(7,7,7),(8,8,8),(9,9,9),(10,10,10),
(11,11,11),(12,12,12),(13,13,13),(14,14,14),(15,15,15),
(16,16,16),(17,17,17),(18,18,18),(19,19,19),(20,20,20),
(21,21,21),(22,22,22),(23,23,23),(24,24,24),(25,25,25),
(26,26,26),(27,27,27),(28,28,28),(29,29,29),(30,30,30),
(31,31,31),(32,32,32),(33,33,33),(34,34,34),(35,35,35),
(36,36,36),(37,37,37),(38,38,38),(39,39,39),(40,40,40),
(41,41,41),(42,42,42),(43,43,43),(44,44,44),(45,45,45),
(46,46,46),(47,47,47),(48,48,48),(49,49,49),(50,50,50),
(51,51,51),(52,52,52),(53,53,53),(54,54,54),(55,55,55),
(56,56,56),(57,57,57),(58,58,58),(59,59,59),(60,60,60),
(61,61,61),(62,62,62),(63,63,63),(64,64,64),(65,65,65),
(66,66,66),(67,67,67),(68,68,68),(69,69,69),(70,70,70),
(71,71,71),(72,72,72),(73,73,73),(74,74,74),(75,75,75),
(76,76,76),(77,77,77),(78,78,78),(79,79,79),(80,80,80),
(81,81,81),(82,82,82),(83,83,83),(84,84,84),(85,85,85),
(86,86,86),(87,87,87),(88,88,88),(89,89,89),(90,90,90),
(91,91,91),(92,92,92),(93,93,93),(94,94,94),(95,95,95),
(96,96,96),(97,97,97),(98,98,98),(99,99,99),(100,100,100);
insert into t2 select * from t1;
insert into t3 select * from t1;
insert into t4 select * from t1;
insert into t5 (a,b,c) select a,b,if(a%2,b,NULL) as c from t1;
select count(*) from t1;
count(*)
100
select count(*) from t2;
count(*)
100
select count(*) from t3;
count(*)
100
select count(*) from t4;
count(*)
100
select count(*) from t5;
count(*)
100
select * from t1 where a < 20;
a	b	c
1	1	1
10	10	10
11	11	11
12	12	12
13	13	13
14	14	14
15	15	15
16	16	16
17	17	17
18	18	18
19	19	19
2	2	2
3	3	3
4	4	4
5	5	5
6	6	6
7	7	7
8	8	8
9	9	9
select * from t1 where a = 20;
a	b	c
20	20	20
select * from t1 where a = 30;
a	b	c
30	30	30
select * from t1 where a = 40;
a	b	c
40	40	40
select * from t1 where a = 50;
a	b	c
50	50	50
select * from t1 where b = 20;
a	b	c
20	20	20
select * from t1 where b = 30;
a	b	c
30	30	30
select * from t1 where b = 40;
a	b	c
40	40	40
select * from t1 where b = 50;
a	b	c
50	50	50
select * from t2 where a < 20;
a	b	c
1	1	1
10	10	10
11	11	11
12	12	12
13	13	13
14	14	14
15	15	15
16	16	16
17	17	17
18	18	18
19	19	19
2	2	2
3	3	3
4	4	4
5	5	5
6	6	6
7	7	7
8	8	8
9	9	9
select * from t2 where a = 20;
a	b	c
20	20	20
select * from t2 where a = 30;
a	b	c
30	30	30
select * from t2 where a = 40;
a	b	c
40	40	40
select * from t2 where a = 50;
a	b	c
50	50	50
select * from t2 where b = 20;
a	b	c
20	20	20
select * from t2 where b = 30;
a	b	c
30	30	30
select * from t2 where b = 40;
a	b	c
40	40	40
select * from t2 where b = 50;
a	b	c
50	50	50
select * from t3 where a < 20;
a	b	c
1	1	1
10	10	10
11	11	11
12	12	12
13	13	13
14	14	14
15	15	15
16	16	16
17	17	17
18	18	18
19	19	19
2	2	2
3	3	3
4	4	4
5	5	5
6	6	6
7	7	7
8	8	8
9	9	9
select * from t3 where a = 20;
a	b	c
20	20	20
select * from t3 where a = 30;
a	b	c
30	30	30
select * from t3 where a = 40;
a	b	c
40	40	40
select * from t3 where a = 50;
a	b	c
50	50	50
select * from t3 where b = 20;
a	b	c
20	20	20
select * from t3 where b = 30;
a	b	c
30	30	30
select * from t3 where b = 40;
a	b	c
40	40	40
select * from t3 where b = 50;
a	b	c
50	50	50
select * from t4 where a < 20;
a	b	c
1	1	1
10	10	10
11	11	11
12	12	12
13	13	13
14	14	14
15	15	15
16	16	16
17	17	17
18	18	18
19	19	19
2	2	2
3	3	3
4	4	4
5	5	5
6	6	6
7	7	7
8	8	8
9	9	9
select * from t4 where a = 20;
a	b	c
20	20	20
select * from t4 where a = 30;
a	b	c
30	30	30
select * from t4 where a = 40;
a	b	c
40	40	40
select * from t4 where a = 50;
a	b	c
50	50	50
select * from t4 where b = 20;
a	b	c
20	20	20
select * from t4 where b = 30;
a	b	c
30	30	30
select * from t4 where b = 40;
a	b	c
40	40	40
select * from t4 where b = 50;
a	b	c
50	50	50
alter table t1 algorithm=inplace, reorganize partition;
-- t1 --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 3
Number of primary keys: 2
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 0
ForceVarPart: 1
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: DEFAULT-HASHMAP-3840-2
-- Attributes --
a Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
c Unsigned PRIMARY KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(a, c) - UniqueHashIndex
PRIMARY(a, c) - OrderedIndex
b(b) - OrderedIndex
b$unique(b) - UniqueHashIndex
-- t1/PRIMARY --
Version: Any
Base table: t1
Number of attributes: 2
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
a Unsigned NOT NULL AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/PRIMARY --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 3
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
a Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t1/b --
Version: Any
Base table: t1
Number of attributes: 1
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/b --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t1/b$unique --
Version: Any
Base table: t1
Number of attributes: 1
Logging: 1
Index type: UniqueHashIndex
Index status: Retrieved
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- IndexTable XX/b$unique --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: DEFAULT-HASHMAP-3840-2
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$PK Unsigned [3] NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(b) - UniqueHashIndex


NDBT_ProgramExit: 0 - OK

alter table t2 algorithm=inplace, reorganize partition;
-- t2 --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 3
Number of primary keys: 2
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 0
ForceVarPart: 1
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: DEFAULT-HASHMAP-3840-2
Tablespace id: XX
Tablespace: ts1
-- Attributes --
a Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned PRIMARY KEY AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=DISK
-- Indexes -- 
PRIMARY KEY(a, b) - UniqueHashIndex
PRIMARY(a, b) - OrderedIndex
b(b) - OrderedIndex
b$unique(b) - UniqueHashIndex
-- t2/PRIMARY --
Version: Any
Base table: t2
Number of attributes: 2
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
a Unsigned NOT NULL AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/PRIMARY --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 3
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
a Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t2/b --
Version: Any
Base table: t2
Number of attributes: 1
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/b --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t2/b$unique --
Version: Any
Base table: t2
Number of attributes: 1
Logging: 1
Index type: UniqueHashIndex
Index status: Retrieved
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- IndexTable XX/b$unique --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 2
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: DEFAULT-HASHMAP-3840-2
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$PK Unsigned [3] NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(b) - UniqueHashIndex


NDBT_ProgramExit: 0 - OK

Cannot use inplace reorganize partition on t3 as it has explicit MAX_ROWS set
alter table t3 algorithm=inplace, reorganize partition;
ERROR 0A000: ALGORITHM=INPLACE is not supported. Reason: REORGANIZE of table with MAX_ROWS. Try ALGORITHM=COPY.
show warnings;
Level	Code	Message
Error	1846	ALGORITHM=INPLACE is not supported. Reason: REORGANIZE of table with MAX_ROWS. Try ALGORITHM=COPY.
alter table t3 algorithm=inplace, max_rows=50000000;
-- t3 --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 3
Number of primary keys: 2
Length of frm data: XXX
Max Rows: 50000000
Row Checksum: 1
Row GCI: 1
SingleUserMode: 0
ForceVarPart: 1
PartitionCount: 4
FragmentCount: 4
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: DEFAULT-HASHMAP-3840-4
-- Attributes --
a Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(a, b) - UniqueHashIndex
PRIMARY(a, b) - OrderedIndex
b(b) - OrderedIndex
b$unique(b) - UniqueHashIndex
-- t3/PRIMARY --
Version: Any
Base table: t3
Number of attributes: 2
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
a Unsigned NOT NULL AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/PRIMARY --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 3
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 4
FragmentCount: 4
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
a Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t3/b --
Version: Any
Base table: t3
Number of attributes: 1
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/b --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 4
FragmentCount: 4
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t3/b$unique --
Version: Any
Base table: t3
Number of attributes: 1
Logging: 1
Index type: UniqueHashIndex
Index status: Retrieved
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- IndexTable XX/b$unique --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 4
FragmentCount: 4
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: DEFAULT-HASHMAP-3840-4
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$PK Unsigned [3] NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(b) - UniqueHashIndex


NDBT_ProgramExit: 0 - OK

alter table t4 algorithm=inplace, reorganize partition;
alter table t5 algorithm=inplace partition by key() partitions 6;
ERROR 0A000: ALGORITHM=INPLACE is not supported. Reason: Detected unsupported change. Try ALGORITHM=COPY.
Check partitions added, expect 0 in all cases
partitions added to t1
t1_added
0
partitions added to t2
t2_added
0
partitions added to t3
t3_added
0
partitions added to t4
t4_added
0
alter table t1 algorithm=inplace, add partition partitions 1;
-- t1 --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 3
Number of primary keys: 2
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 0
ForceVarPart: 1
PartitionCount: 3
FragmentCount: 3
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: HASHMAP-3840-2-3
-- Attributes --
a Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
c Unsigned PRIMARY KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(a, c) - UniqueHashIndex
PRIMARY(a, c) - OrderedIndex
b(b) - OrderedIndex
b$unique(b) - UniqueHashIndex
-- t1/PRIMARY --
Version: Any
Base table: t1
Number of attributes: 2
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
a Unsigned NOT NULL AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/PRIMARY --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 3
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 3
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
a Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t1/b --
Version: Any
Base table: t1
Number of attributes: 1
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/b --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 3
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t1/b$unique --
Version: Any
Base table: t1
Number of attributes: 1
Logging: 1
Index type: UniqueHashIndex
Index status: Retrieved
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- IndexTable XX/b$unique --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 3
FragmentCount: 3
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: HASHMAP-3840-2-3
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$PK Unsigned [3] NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(b) - UniqueHashIndex


NDBT_ProgramExit: 0 - OK

alter table t2 algorithm=inplace, add partition partitions 4;
-- t2 --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 3
Number of primary keys: 2
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 0
ForceVarPart: 1
PartitionCount: 6
FragmentCount: 6
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: DEFAULT-HASHMAP-3840-6
Tablespace id: XX
Tablespace: ts1
-- Attributes --
a Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned PRIMARY KEY AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=DISK
-- Indexes -- 
PRIMARY KEY(a, b) - UniqueHashIndex
PRIMARY(a, b) - OrderedIndex
b(b) - OrderedIndex
b$unique(b) - UniqueHashIndex
-- t2/PRIMARY --
Version: Any
Base table: t2
Number of attributes: 2
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
a Unsigned NOT NULL AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/PRIMARY --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 3
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 6
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
a Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t2/b --
Version: Any
Base table: t2
Number of attributes: 1
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/b --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 6
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t2/b$unique --
Version: Any
Base table: t2
Number of attributes: 1
Logging: 1
Index type: UniqueHashIndex
Index status: Retrieved
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- IndexTable XX/b$unique --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 6
FragmentCount: 6
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: DEFAULT-HASHMAP-3840-6
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$PK Unsigned [3] NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(b) - UniqueHashIndex


NDBT_ProgramExit: 0 - OK

alter table t3 algorithm=inplace, max_rows=100000000;
-- t3 --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 3
Number of primary keys: 2
Length of frm data: XXX
Max Rows: 50000000
Row Checksum: 1
Row GCI: 1
SingleUserMode: 0
ForceVarPart: 1
PartitionCount: 6
FragmentCount: 6
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: HASHMAP-3840-4-6
-- Attributes --
a Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(a, b) - UniqueHashIndex
PRIMARY(a, b) - OrderedIndex
b(b) - OrderedIndex
b$unique(b) - UniqueHashIndex
-- t3/PRIMARY --
Version: Any
Base table: t3
Number of attributes: 2
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
a Unsigned NOT NULL AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/PRIMARY --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 3
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 4
FragmentCount: 6
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
a Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t3/b --
Version: Any
Base table: t3
Number of attributes: 1
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/b --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 4
FragmentCount: 6
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t3/b$unique --
Version: Any
Base table: t3
Number of attributes: 1
Logging: 1
Index type: UniqueHashIndex
Index status: Retrieved
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- IndexTable XX/b$unique --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 6
FragmentCount: 6
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: HASHMAP-3840-4-6
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$PK Unsigned [3] NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(b) - UniqueHashIndex


NDBT_ProgramExit: 0 - OK

alter table t4 algorithm=inplace, max_rows=100000000;
ERROR 0A000: ALGORITHM=INPLACE is not supported. Reason: setting MAX_ROWS on table without MAX_ROWS. Try ALGORITHM=COPY.
partitions added to t1 (expect 1)
t1_added
1
partitions added to t2 (expect 4)
t2_added
4
partitions added to t3 (expect 4)
t3_added
2
partitions added to t4 (expect 0)
t4_added
0
alter table t1 algorithm=inplace, reorganize partition;
ERROR HY000: REORGANIZE PARTITION without parameters can only be used on auto-partitioned tables using HASH PARTITIONs
alter table t3 algorithm=inplace, reorganize partition;
ERROR 0A000: ALGORITHM=INPLACE is not supported. Reason: REORGANIZE of table with MAX_ROWS. Try ALGORITHM=COPY.
show warnings;
Level	Code	Message
Error	1846	ALGORITHM=INPLACE is not supported. Reason: REORGANIZE of table with MAX_ROWS. Try ALGORITHM=COPY.
alter table t4 algorithm=inplace, reorganize partition;
select count(*) from t1;
count(*)
100
select count(*) from t2;
count(*)
100
select * from t1 where a < 20;
a	b	c
1	1	1
10	10	10
11	11	11
12	12	12
13	13	13
14	14	14
15	15	15
16	16	16
17	17	17
18	18	18
19	19	19
2	2	2
3	3	3
4	4	4
5	5	5
6	6	6
7	7	7
8	8	8
9	9	9
select * from t1 where a = 20;
a	b	c
20	20	20
select * from t1 where a = 30;
a	b	c
30	30	30
select * from t1 where a = 40;
a	b	c
40	40	40
select * from t1 where a = 50;
a	b	c
50	50	50
select * from t1 where b = 20;
a	b	c
20	20	20
select * from t1 where b = 30;
a	b	c
30	30	30
select * from t1 where b = 40;
a	b	c
40	40	40
select * from t1 where b = 50;
a	b	c
50	50	50
select * from t2 where a < 20;
a	b	c
1	1	1
10	10	10
11	11	11
12	12	12
13	13	13
14	14	14
15	15	15
16	16	16
17	17	17
18	18	18
19	19	19
2	2	2
3	3	3
4	4	4
5	5	5
6	6	6
7	7	7
8	8	8
9	9	9
select * from t2 where a = 20;
a	b	c
20	20	20
select * from t2 where a = 30;
a	b	c
30	30	30
select * from t2 where a = 40;
a	b	c
40	40	40
select * from t2 where a = 50;
a	b	c
50	50	50
select * from t2 where b = 20;
a	b	c
20	20	20
select * from t2 where b = 30;
a	b	c
30	30	30
select * from t2 where b = 40;
a	b	c
40	40	40
select * from t2 where b = 50;
a	b	c
50	50	50
select * from t3 where a < 20;
a	b	c
1	1	1
10	10	10
11	11	11
12	12	12
13	13	13
14	14	14
15	15	15
16	16	16
17	17	17
18	18	18
19	19	19
2	2	2
3	3	3
4	4	4
5	5	5
6	6	6
7	7	7
8	8	8
9	9	9
select * from t3 where a = 20;
a	b	c
20	20	20
select * from t3 where a = 30;
a	b	c
30	30	30
select * from t3 where a = 40;
a	b	c
40	40	40
select * from t3 where a = 50;
a	b	c
50	50	50
select * from t3 where b = 20;
a	b	c
20	20	20
select * from t3 where b = 30;
a	b	c
30	30	30
select * from t3 where b = 40;
a	b	c
40	40	40
select * from t3 where b = 50;
a	b	c
50	50	50
select * from t4 where a < 20;
a	b	c
1	1	1
10	10	10
11	11	11
12	12	12
13	13	13
14	14	14
15	15	15
16	16	16
17	17	17
18	18	18
19	19	19
2	2	2
3	3	3
4	4	4
5	5	5
6	6	6
7	7	7
8	8	8
9	9	9
select * from t4 where a = 20;
a	b	c
20	20	20
select * from t4 where a = 30;
a	b	c
30	30	30
select * from t4 where a = 40;
a	b	c
40	40	40
select * from t4 where a = 50;
a	b	c
50	50	50
select * from t4 where b = 20;
a	b	c
20	20	20
select * from t4 where b = 30;
a	b	c
30	30	30
select * from t4 where b = 40;
a	b	c
40	40	40
select * from t4 where b = 50;
a	b	c
50	50	50
Table: test.t4
PartitionCount: 2
FragmentCount: 2

b$unique(b) - UniqueHashIndex
FragmentCount: 2
drop table t4;
alter table t1 algorithm=inplace, add partition partitions 2;
-- t1 --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 3
Number of primary keys: 2
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 0
ForceVarPart: 1
PartitionCount: 5
FragmentCount: 5
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: HASHMAP-3840-3-5
-- Attributes --
a Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
c Unsigned PRIMARY KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(a, c) - UniqueHashIndex
PRIMARY(a, c) - OrderedIndex
b(b) - OrderedIndex
b$unique(b) - UniqueHashIndex
-- t1/PRIMARY --
Version: Any
Base table: t1
Number of attributes: 2
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
a Unsigned NOT NULL AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/PRIMARY --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 3
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 5
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
a Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t1/b --
Version: Any
Base table: t1
Number of attributes: 1
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/b --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 5
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t1/b$unique --
Version: Any
Base table: t1
Number of attributes: 1
Logging: 1
Index type: UniqueHashIndex
Index status: Retrieved
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- IndexTable XX/b$unique --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 5
FragmentCount: 5
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: HASHMAP-3840-3-5
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$PK Unsigned [3] NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(b) - UniqueHashIndex


NDBT_ProgramExit: 0 - OK

alter table t2 algorithm=inplace, add partition partitions 1;
-- t2 --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 3
Number of primary keys: 2
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 0
ForceVarPart: 1
PartitionCount: 7
FragmentCount: 7
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: HASHMAP-3840-6-7
Tablespace id: XX
Tablespace: ts1
-- Attributes --
a Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned PRIMARY KEY AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=DISK
-- Indexes -- 
PRIMARY KEY(a, b) - UniqueHashIndex
PRIMARY(a, b) - OrderedIndex
b(b) - OrderedIndex
b$unique(b) - UniqueHashIndex
-- t2/PRIMARY --
Version: Any
Base table: t2
Number of attributes: 2
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
a Unsigned NOT NULL AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/PRIMARY --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 3
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 7
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
a Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t2/b --
Version: Any
Base table: t2
Number of attributes: 1
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/b --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 2
FragmentCount: 7
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t2/b$unique --
Version: Any
Base table: t2
Number of attributes: 1
Logging: 1
Index type: UniqueHashIndex
Index status: Retrieved
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- IndexTable XX/b$unique --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 7
FragmentCount: 7
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: HASHMAP-3840-6-7
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$PK Unsigned [3] NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(b) - UniqueHashIndex


NDBT_ProgramExit: 0 - OK

alter table t3 algorithm=inplace, max_rows=150000000;
-- t3 --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 3
Number of primary keys: 2
Length of frm data: XXX
Max Rows: 50000000
Row Checksum: 1
Row GCI: 1
SingleUserMode: 0
ForceVarPart: 1
PartitionCount: 8
FragmentCount: 8
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: HASHMAP-3840-6-8
-- Attributes --
a Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
c Unsigned NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(a, b) - UniqueHashIndex
PRIMARY(a, b) - OrderedIndex
b(b) - OrderedIndex
b$unique(b) - UniqueHashIndex
-- t3/PRIMARY --
Version: Any
Base table: t3
Number of attributes: 2
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
a Unsigned NOT NULL AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/PRIMARY --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 3
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 4
FragmentCount: 8
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
a Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t3/b --
Version: Any
Base table: t3
Number of attributes: 1
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/b --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 4
FragmentCount: 8
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t3/b$unique --
Version: Any
Base table: t3
Number of attributes: 1
Logging: 1
Index type: UniqueHashIndex
Index status: Retrieved
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- IndexTable XX/b$unique --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 8
FragmentCount: 8
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: HASHMAP-3840-6-8
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$PK Unsigned [3] NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(b) - UniqueHashIndex


NDBT_ProgramExit: 0 - OK

partitions added to t1 (expect 3)
t1_added
3
partitions added to t2 (expect 5)
t2_added
5
partitions added to t3 (expect 4)
t3_added
4
select count(*) from t1;
count(*)
100
select count(*) from t2;
count(*)
100
select * from t1 where a < 20;
a	b	c
1	1	1
10	10	10
11	11	11
12	12	12
13	13	13
14	14	14
15	15	15
16	16	16
17	17	17
18	18	18
19	19	19
2	2	2
3	3	3
4	4	4
5	5	5
6	6	6
7	7	7
8	8	8
9	9	9
select * from t1 where a = 20;
a	b	c
20	20	20
select * from t1 where a = 30;
a	b	c
30	30	30
select * from t1 where a = 40;
a	b	c
40	40	40
select * from t1 where a = 50;
a	b	c
50	50	50
select * from t1 where b = 20;
a	b	c
20	20	20
select * from t1 where b = 30;
a	b	c
30	30	30
select * from t1 where b = 40;
a	b	c
40	40	40
select * from t1 where b = 50;
a	b	c
50	50	50
select * from t2 where a < 20;
a	b	c
1	1	1
10	10	10
11	11	11
12	12	12
13	13	13
14	14	14
15	15	15
16	16	16
17	17	17
18	18	18
19	19	19
2	2	2
3	3	3
4	4	4
5	5	5
6	6	6
7	7	7
8	8	8
9	9	9
select * from t2 where a = 20;
a	b	c
20	20	20
select * from t2 where a = 30;
a	b	c
30	30	30
select * from t2 where a = 40;
a	b	c
40	40	40
select * from t2 where a = 50;
a	b	c
50	50	50
select * from t2 where b = 20;
a	b	c
20	20	20
select * from t2 where b = 30;
a	b	c
30	30	30
select * from t2 where b = 40;
a	b	c
40	40	40
select * from t2 where b = 50;
a	b	c
50	50	50
select * from t3 where a < 20;
a	b	c
1	1	1
10	10	10
11	11	11
12	12	12
13	13	13
14	14	14
15	15	15
16	16	16
17	17	17
18	18	18
19	19	19
2	2	2
3	3	3
4	4	4
5	5	5
6	6	6
7	7	7
8	8	8
9	9	9
select * from t3 where a = 20;
a	b	c
20	20	20
select * from t3 where a = 30;
a	b	c
30	30	30
select * from t3 where a = 40;
a	b	c
40	40	40
select * from t3 where a = 50;
a	b	c
50	50	50
select * from t3 where b = 20;
a	b	c
20	20	20
select * from t3 where b = 30;
a	b	c
30	30	30
select * from t3 where b = 40;
a	b	c
40	40	40
select * from t3 where b = 50;
a	b	c
50	50	50
Table: test.t1
PartitionCount: 5
FragmentCount: 5

b$unique(b) - UniqueHashIndex
FragmentCount: 5
Table: test.t2
PartitionCount: 7
FragmentCount: 7

b$unique(b) - UniqueHashIndex
FragmentCount: 7
Table: test.t3
PartitionCount: 8
FragmentCount: 8

b$unique(b) - UniqueHashIndex
FragmentCount: 8
Table: test.t5
PartitionCount: 3
FragmentCount: 3

b$unique(b) - UniqueHashIndex
FragmentCount: 3
c$unique(c) - UniqueHashIndex
FragmentCount: 3
alter table t5 algorithm=inplace, add partition partitions 1;
-- t5 --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 3
Number of primary keys: 2
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 0
ForceVarPart: 1
PartitionCount: 4
FragmentCount: 4
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: HASHMAP-3840-3-4
-- Attributes --
a Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned PRIMARY KEY AT=FIXED ST=MEMORY
c Unsigned NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(a, b) - UniqueHashIndex
PRIMARY(a, b) - OrderedIndex
b(b) - OrderedIndex
b$unique(b) - UniqueHashIndex
c(c) - OrderedIndex
c$unique(c) - UniqueHashIndex
-- t5/PRIMARY --
Version: Any
Base table: t5
Number of attributes: 2
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
a Unsigned NOT NULL AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/PRIMARY --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 3
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 3
FragmentCount: 4
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
a Unsigned NOT NULL DISTRIBUTION KEY AT=FIXED ST=MEMORY
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t5/b --
Version: Any
Base table: t5
Number of attributes: 1
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
-- IndexTable XX/b --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 3
FragmentCount: 4
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
b Unsigned NOT NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t5/b$unique --
Version: Any
Base table: t5
Number of attributes: 1
Logging: 1
Index type: UniqueHashIndex
Index status: Retrieved
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- IndexTable XX/b$unique --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 4
FragmentCount: 4
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: HASHMAP-3840-3-4
-- Attributes --
b Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$PK Unsigned [3] NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(b) - UniqueHashIndex

-- t5/c --
Version: Any
Base table: t5
Number of attributes: 1
Logging: 0
Index type: OrderedIndex
Index status: Retrieved
-- Attributes --
c Unsigned NULL AT=FIXED ST=MEMORY
-- IndexTable XX/c --
Version: Any
Fragment type: FragUndefined
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: yes
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 3
FragmentCount: 4
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
-- Attributes --
c Unsigned NULL AT=FIXED ST=MEMORY
NDB$TNODE Unsigned [64] PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(NDB$TNODE) - UniqueHashIndex

-- t5/c$unique --
Version: Any
Base table: t5
Number of attributes: 1
Logging: 1
Index type: UniqueHashIndex
Index status: Retrieved
-- Attributes --
c Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
-- IndexTable XX/c$unique --
Version: Any
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 2
Number of primary keys: 1
Length of frm data: XXX
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 2
ForceVarPart: 0
PartitionCount: 4
FragmentCount: 4
PartitionBalance: SPECIFIC
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options: readbackup
HashMap: HASHMAP-3840-3-4
-- Attributes --
c Unsigned PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
NDB$PK Unsigned [3] NOT NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(c) - UniqueHashIndex


NDBT_ProgramExit: 0 - OK

drop table t1,t2,t3,t5;
Bug 33523991 Ndb online reorg : Scan count verification
Scan count issue on complete phase of reorg
create table t1 (a int primary key, b int, c int, d int, unique(b), unique(c)) engine=ndb;
Populate some data
insert into t1 values (1,1,1,1);
insert into t1 select a+1, b+1, c+1, d+1 from t1;
insert into t1 select a+2, b+2, c+2, d+2 from t1;
insert into t1 select a+4, b+4, c+4, d+4 from t1;
insert into t1 select a+8, b+8, c+8, d+8 from t1;
insert into t1 select a+16, b+16, c+16, d+16 from t1;
insert into t1 select a+32, b+32, c+32, d+32 from t1;
insert into t1 select a+64, b+64, c+64, d+64 from t1;
insert into t1 select a+128, b+128, c+128, d+128 from t1;
insert into t1 select a+256, b+256, c+256, d+256 from t1;
insert into t1 select a+512, b+512, c+512, d+512 from t1;
insert into t1 select a+1024, b+1024, c+1024, d+1024 from t1;
insert into t1 select a+2048, b+2048, c+2048, d+2048 from t1;
create procedure scans (max_iterations int)
sp: begin
DECLARE sum_d int;
set @x=0;
repeat
select sum(d) into sum_d from t1;
set @x = @x + 1;
if sum_d = 0
then
leave sp;
end if;
until @x=max_iterations
end repeat;
end%
call scans(20000);;
alter table t1 algorithm=inplace, add partition partitions 1;
Alter ok, run again
alter table t1 algorithm=inplace, add partition partitions 1;
Second alter ok, finish scans
select sum(d) into @sum_d from t1;
insert into t1 values (20000,20000,20000, 0 - @sum_d);
drop procedure scans;
drop table t1;
alter tablespace ts1 drop datafile 'datafile.dat';
drop tablespace ts1;
drop logfile group lg1 engine = ndb;
