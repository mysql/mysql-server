--source include/have_ndb.inc

--echo #
--echo # Testing bug#21837074
--echo #

CALL mtr.add_suppression("Incorrect information in file");
# Ignore the warning generated by ndbcluster's binlog thread
# when cluster is restarted
--disable_query_log ONCE
call mtr.add_suppression("cluster disconnect An incident event has been written");

# Ignore the warning generated by ndbcluster's binlog thread
# when cluster is restarted - also on the second mysqld
connect(mysqld2,127.0.0.1,root,,test,$MASTER_MYPORT1);
connection mysqld2;
--disable_query_log ONCE
call mtr.add_suppression("cluster disconnect An incident event has been written");
connection default;

create table test.t1(i int primary key) engine=ndb;

--echo # Restarting all the nodes with 'no start'
--source ndb_restart_nostart.inc

--error 1296,1297
show create table test.t1;
--echo # Show create table failed as expected. Now starting the nodes again

--echo # Start NDB nodes back up again.
--source ndb_restart_start.inc

--echo # Wait until mysqld has connected properly to cluster
source include/ndb_not_readonly.inc;
connection mysqld2;
source include/ndb_not_readonly.inc;
connection default;

--echo # mysqld connected to cluster. Now running show create table again.
--disable_warnings
show create table test.t1;
--enable_warnings

#Clean Up
drop table test.t1;
--echo # End of bug#21837074


