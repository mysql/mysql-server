set binlog_format=statement;
Warnings:
Warning	1287	'@@binlog_format' is deprecated and will be removed in a future release.

# 'DROP TABLE IF EXISTS <deleted table>' are binlogged
# for each table in SEs not supporting atomic DDL which
# were dropped by failed 'DROP DATABASE'.
#
# Unlike test for bug#11765416/58381 this test uses MyISAM
# for t1. So failed DROP DATABASE will have side-effect even
# though removal of InnoDB tables is rolled back.
# DROP TABLE IF EXISTS is logged for MyISAM table in this case.
RESET MASTER;
CREATE DATABASE testing_1;
USE testing_1;
CREATE TABLE t1(c1 INT) ENGINE=MyISAM;
CREATE TABLE t2(c1 INT PRIMARY KEY) ENGINE=InnoDB;
#
# 'DROP DATABASE' will fail but will delete table t1.
#
SET SESSION DEBUG='+d,rm_table_no_locks_abort_after_atomic_tables';
DROP DATABASE testing_1;
ERROR HY000: Unknown error
SET SESSION DEBUG='-d,rm_table_no_locks_abort_after_atomic_tables';
include/show_binlog_events.inc
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
binlog.000001	#	Query	#	#	CREATE DATABASE testing_1
binlog.000001	#	Query	#	#	use `testing_1`; CREATE TABLE t1(c1 INT) ENGINE=MyISAM
binlog.000001	#	Query	#	#	use `testing_1`; CREATE TABLE t2(c1 INT PRIMARY KEY) ENGINE=InnoDB
binlog.000001	#	Query	#	#	use `testing_1`; DROP TABLE IF EXISTS `t1` /* generated by server */
# Cleanup.
DROP DATABASE testing_1;
set binlog_format=mixed;
Warnings:
Warning	1287	'@@binlog_format' is deprecated and will be removed in a future release.

# 'DROP TABLE IF EXISTS <deleted table>' are binlogged
# for each table in SEs not supporting atomic DDL which
# were dropped by failed 'DROP DATABASE'.
#
# Unlike test for bug#11765416/58381 this test uses MyISAM
# for t1. So failed DROP DATABASE will have side-effect even
# though removal of InnoDB tables is rolled back.
# DROP TABLE IF EXISTS is logged for MyISAM table in this case.
RESET MASTER;
CREATE DATABASE testing_1;
USE testing_1;
CREATE TABLE t1(c1 INT) ENGINE=MyISAM;
CREATE TABLE t2(c1 INT PRIMARY KEY) ENGINE=InnoDB;
#
# 'DROP DATABASE' will fail but will delete table t1.
#
SET SESSION DEBUG='+d,rm_table_no_locks_abort_after_atomic_tables';
DROP DATABASE testing_1;
ERROR HY000: Unknown error
SET SESSION DEBUG='-d,rm_table_no_locks_abort_after_atomic_tables';
include/show_binlog_events.inc
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
binlog.000001	#	Query	#	#	CREATE DATABASE testing_1
binlog.000001	#	Query	#	#	use `testing_1`; CREATE TABLE t1(c1 INT) ENGINE=MyISAM
binlog.000001	#	Query	#	#	use `testing_1`; CREATE TABLE t2(c1 INT PRIMARY KEY) ENGINE=InnoDB
binlog.000001	#	Query	#	#	use `testing_1`; DROP TABLE IF EXISTS `t1` /* generated by server */
# Cleanup.
DROP DATABASE testing_1;
set binlog_format='row';
Warnings:
Warning	1287	'@@binlog_format' is deprecated and will be removed in a future release.

# 'DROP TABLE IF EXISTS <deleted table>' are binlogged
# for each table in SEs not supporting atomic DDL which
# were dropped by failed 'DROP DATABASE'.
#
# Unlike test for bug#11765416/58381 this test uses MyISAM
# for t1. So failed DROP DATABASE will have side-effect even
# though removal of InnoDB tables is rolled back.
# DROP TABLE IF EXISTS is logged for MyISAM table in this case.
RESET MASTER;
CREATE DATABASE testing_1;
USE testing_1;
CREATE TABLE t1(c1 INT) ENGINE=MyISAM;
CREATE TABLE t2(c1 INT PRIMARY KEY) ENGINE=InnoDB;
#
# 'DROP DATABASE' will fail but will delete table t1.
#
SET SESSION DEBUG='+d,rm_table_no_locks_abort_after_atomic_tables';
DROP DATABASE testing_1;
ERROR HY000: Unknown error
SET SESSION DEBUG='-d,rm_table_no_locks_abort_after_atomic_tables';
include/show_binlog_events.inc
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
binlog.000001	#	Query	#	#	CREATE DATABASE testing_1
binlog.000001	#	Query	#	#	use `testing_1`; CREATE TABLE t1(c1 INT) ENGINE=MyISAM
binlog.000001	#	Query	#	#	use `testing_1`; CREATE TABLE t2(c1 INT PRIMARY KEY) ENGINE=InnoDB
binlog.000001	#	Query	#	#	use `testing_1`; DROP TABLE IF EXISTS `t1` /* generated by server */
# Cleanup.
DROP DATABASE testing_1;
show databases;
Database
information_schema
mtr
mysql
performance_schema
sys
test
