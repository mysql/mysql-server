include/begin_replace_gtid_combination.inc [gtid_mode=off/on -> default_storage_engine=InnoDB/MyISAM]
include/rpl_init.inc [topology=none]
SET @old_sql_notes= @@GLOBAL.SQL_NOTES;
SET GLOBAL SQL_NOTES= 0;
SET SESSION SQL_NOTES= 0;
CALL mtr.add_suppression('Statement violates GTID consistency:');
CALL mtr.add_suppression('Unsafe statement written to the binary log');
SET GLOBAL ENFORCE_GTID_CONSISTENCY = 0;
SET GLOBAL GTID_MODE = OFF_PERMISSIVE;
SET GLOBAL GTID_MODE = ON_PERMISSIVE;
SET GLOBAL GTID_MODE = 2;
######## ENFORCE_GTID_CONSISTENCY=OFF GTID_MODE=ON_PERMISSIVE GTID_NEXT=AUTOMATIC ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=OFF GTID_MODE=ON_PERMISSIVE GTID_NEXT=ANONYMOUS ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=OFF GTID_MODE=ON_PERMISSIVE GTID_NEXT=GTID ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
SET GLOBAL GTID_MODE = 1;
######## ENFORCE_GTID_CONSISTENCY=OFF GTID_MODE=OFF_PERMISSIVE GTID_NEXT=AUTOMATIC ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=OFF GTID_MODE=OFF_PERMISSIVE GTID_NEXT=ANONYMOUS ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=OFF GTID_MODE=OFF_PERMISSIVE GTID_NEXT=GTID ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
SET GLOBAL GTID_MODE = 0;
######## ENFORCE_GTID_CONSISTENCY=OFF GTID_MODE=OFF GTID_NEXT=AUTOMATIC ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=OFF GTID_MODE=OFF GTID_NEXT=ANONYMOUS ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=0 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [No warning or error should be generated.]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
SET GLOBAL ENFORCE_GTID_CONSISTENCY = 1;
SET GLOBAL GTID_MODE = OFF_PERMISSIVE;
SET GLOBAL GTID_MODE = ON_PERMISSIVE;
SET GLOBAL GTID_MODE = ON;
SET GLOBAL GTID_MODE = 3;
######## ENFORCE_GTID_CONSISTENCY=ERROR GTID_MODE=ON GTID_NEXT=AUTOMATIC ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=ERROR GTID_MODE=ON GTID_NEXT=GTID ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=3 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
SET GLOBAL GTID_MODE = 2;
######## ENFORCE_GTID_CONSISTENCY=ERROR GTID_MODE=ON_PERMISSIVE GTID_NEXT=AUTOMATIC ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=ERROR GTID_MODE=ON_PERMISSIVE GTID_NEXT=ANONYMOUS ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=ERROR GTID_MODE=ON_PERMISSIVE GTID_NEXT=GTID ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
SET GLOBAL GTID_MODE = 1;
######## ENFORCE_GTID_CONSISTENCY=ERROR GTID_MODE=OFF_PERMISSIVE GTID_NEXT=AUTOMATIC ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=ERROR GTID_MODE=OFF_PERMISSIVE GTID_NEXT=ANONYMOUS ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=ERROR GTID_MODE=OFF_PERMISSIVE GTID_NEXT=GTID ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
SET GLOBAL GTID_MODE = 0;
######## ENFORCE_GTID_CONSISTENCY=ERROR GTID_MODE=OFF GTID_NEXT=AUTOMATIC ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=ERROR GTID_MODE=OFF GTID_NEXT=ANONYMOUS ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=1 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
SET GLOBAL ENFORCE_GTID_CONSISTENCY = 2;
SET GLOBAL GTID_MODE = OFF_PERMISSIVE;
SET GLOBAL GTID_MODE = ON_PERMISSIVE;
SET GLOBAL GTID_MODE = 2;
######## ENFORCE_GTID_CONSISTENCY=WARN GTID_MODE=ON_PERMISSIVE GTID_NEXT=AUTOMATIC ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=WARN GTID_MODE=ON_PERMISSIVE GTID_NEXT=ANONYMOUS ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT 1;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT 1;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=WARN GTID_MODE=ON_PERMISSIVE GTID_NEXT=GTID ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=2 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
SET GLOBAL GTID_MODE = 1;
######## ENFORCE_GTID_CONSISTENCY=WARN GTID_MODE=OFF_PERMISSIVE GTID_NEXT=AUTOMATIC ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT 1;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT 1;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=WARN GTID_MODE=OFF_PERMISSIVE GTID_NEXT=ANONYMOUS ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT 1;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT 1;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=WARN GTID_MODE=OFF_PERMISSIVE GTID_NEXT=GTID ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
error ER_GTID_UNSAFE_CREATE_SELECT
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT 1;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=1 gtid_next=GTID
SET GTID_NEXT = 'GTID';
BEGIN; INSERT INTO t0 VALUES (1);;
error ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
ERROR HY000: Cannot execute statements with implicit commit inside a transaction when @@SESSION.GTID_NEXT == 'UUID:NUMBER'.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be an Error, not a Warning.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
Warnings:
Note	1051	Unknown table 'test.t1'
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
SET GLOBAL GTID_MODE = 0;
######## ENFORCE_GTID_CONSISTENCY=WARN GTID_MODE=OFF GTID_NEXT=AUTOMATIC ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT 1;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT 1;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=AUTOMATIC
SET GTID_NEXT = 'AUTOMATIC';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
######## ENFORCE_GTID_CONSISTENCY=WARN GTID_MODE=OFF GTID_NEXT=ANONYMOUS ########
CREATE TABLE t0 (a INT) ENGINE = InnoDB;
CREATE TABLE empty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE empty_myisam (a INT) ENGINE = MyISAM;
CREATE TABLE nonempty_innodb (a INT) ENGINE = InnoDB;
CREATE TABLE nonempty_myisam (a INT) ENGINE = MyISAM;
INSERT INTO nonempty_innodb VALUES (1);
INSERT INTO nonempty_myisam VALUES (1);
---- CREATE ... SELECT (value, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT 1;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (value, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT 1;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT 1;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 1 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM nonempty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (InnoDB, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_innodb;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
---- CREATE ... SELECT (MyISAM, 0 row, ongoing trx) ----
# enforce_gtid_consistency=2 gtid_mode=0 gtid_next=ANONYMOUS
SET GTID_NEXT = 'ANONYMOUS';
BEGIN; INSERT INTO t0 VALUES (1);;
[START] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 1]
[END] CREATE TABLE t1 (a INT) SELECT * FROM empty_myisam;
Warnings:
Warning	1786	Statement violates GTID consistency: CREATE TABLE ... SELECT.
include/assert.inc [One warning/error should be generated.]
include/assert.inc [It should be a Warning, not an Error.]
include/assert.inc [Text should be "violates GTID consistency"]
include/assert.inc [ONGOING_AUTOMATIC_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
include/assert.inc [ONGOING_ANONYMOUS_GTID_VIOLATING_TRANSACTION_COUNT should be 0]
ROLLBACK;
SET GTID_NEXT = 'AUTOMATIC';
include/assert.inc [Both counters should be 0]
DROP TABLE IF EXISTS t1;
DROP TABLE empty_myisam, empty_innodb, nonempty_myisam, nonempty_innodb, t0;
SET GLOBAL ENFORCE_GTID_CONSISTENCY = OFF;
SET GLOBAL SQL_NOTES = @old_sql_notes;
include/rpl_end.inc
include/end_replace_gtid_combination.inc [gtid_mode=off/on -> default_storage_engine=InnoDB/MyISAM]
