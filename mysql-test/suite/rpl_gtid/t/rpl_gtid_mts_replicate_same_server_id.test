# ==== Purpose ====
#
# Verify that --replicate-same-server-id works with GTID_MODE=ON and
# MTS.
#
# ==== Implementation ====
#
# The main implementation is in the .opt file: it sets up master and
# slave with MTS enabled and with replicate-same-server-id enabled.
# The test case just checks that it works to replicate a couple of
# simple statements in this scenario. This test does not actually use
# the same server_id on master and slave.
#
# ==== References ====
#
# BUG#18967791 SLAVE THREAD FAILS WITH MTS + GTID + REPLICATE_SAME_SERVER_ID
#   Prior to this bug, the MTS slave would fail when reading
#   Previous_gtids_log_event.  This only happened when
#   replicate-same-server-id was enabled because any
#   Previous_gtids_log_event in the relay log is generated by the
#   slave and has the slave's server_id.

--source include/not_group_replication_plugin.inc
--source include/only_mts_replica_parallel_workers.inc
--source include/not_rpl_gtid_only.inc
--let $use_gtids= 0
--source include/master-slave.inc

CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (1);
--source include/sync_slave_sql_with_master.inc

--let $assert_cond= a = 1 FROM t1
--let $assert_text= The two statements should have been replicated, so that t1 contains value 1.
--source include/assert.inc

--connection master
DROP TABLE t1;

--source include/rpl_end.inc
