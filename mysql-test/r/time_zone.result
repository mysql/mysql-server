DROP TABLE IF EXISTS t1;
show variables like "system_time_zone";
Variable_name	Value
system_time_zone	MET
select @a:=FROM_UNIXTIME(1);
@a:=FROM_UNIXTIME(1)
1970-01-01 01:00:01
Warnings:
Warning	1287	Setting user variables within expressions is deprecated and will be removed in a future release. Consider alternatives: 'SET variable=expression, ...', or 'SELECT expression(s) INTO variables(s)'.
select unix_timestamp(@a);
unix_timestamp(@a)
1.000000
CREATE TABLE t1 (ts int);
INSERT INTO t1 (ts) VALUES (Unix_timestamp('2002-10-27 01:00'));
INSERT INTO t1 (ts) VALUES (Unix_timestamp('2002-10-27 02:00'));
INSERT INTO t1 (ts) VALUES (Unix_timestamp('2002-10-27 03:00'));
INSERT INTO t1 (ts) VALUES (Unix_timestamp('2002-10-27 02:00'));
INSERT INTO t1 (ts) VALUES (Unix_timestamp('2002-10-27 01:00'));
INSERT INTO t1 (ts) VALUES (Unix_timestamp('2002-10-27 02:00'));
INSERT INTO t1 (ts) VALUES (Unix_timestamp('2003-03-30 02:59:59'));
INSERT INTO t1 (ts) VALUES (Unix_timestamp('2003-03-30 03:00:00'));
INSERT INTO t1 (ts) VALUES (Unix_timestamp('2003-03-30 03:59:59'));
INSERT INTO t1 (ts) VALUES (Unix_timestamp('2003-03-30 04:00:01'));
SELECT ts,from_unixtime(ts) FROM t1;
ts	from_unixtime(ts)
1035673200	2002-10-27 01:00:00
1035680400	2002-10-27 02:00:00
1035684000	2002-10-27 03:00:00
1035680400	2002-10-27 02:00:00
1035673200	2002-10-27 01:00:00
1035680400	2002-10-27 02:00:00
1048986000	2003-03-30 03:00:00
1048986000	2003-03-30 03:00:00
1048989599	2003-03-30 03:59:59
1048989601	2003-03-30 04:00:01
DROP TABLE t1;
CREATE TABLE t1 (ts timestamp);
INSERT IGNORE INTO t1 (ts) VALUES ('2003-03-30 01:59:59'),
('2003-03-30 02:59:59'),
('2003-03-30 03:00:00');
Warnings:
Warning	1299	Invalid TIMESTAMP value in column 'ts' at row 2
DROP TABLE t1;
CREATE TABLE t1 (c1 TIMESTAMP);
SET TIME_ZONE = '+00:00';
SET explicit_defaults_for_timestamp=OFF;
Warnings:
Warning	1287	'explicit_defaults_for_timestamp' is deprecated and will be removed in a future release.
INSERT INTO t1 VALUES('2019-10-27 00:47:42'), ('2019-10-27 00:47:42');
INSERT INTO t1 VALUES('2019-10-27 01:47:42'), ('2019-10-27 01:47:42');
SET TIME_ZONE = 'SYSTEM';
SELECT DISTINCT c1 FROM t1;
c1
2019-10-27 02:47:42
2019-10-27 02:47:42
SELECT COUNT(*) FROM t1 GROUP BY c1;
COUNT(*)
2
2
SET sql_mode='';
SELECT COUNT(*) FROM t1 GROUP BY c1;
COUNT(*)
2
2
SET sql_mode=DEFAULT;
SET explicit_defaults_for_timestamp=ON;
DROP TABLE t1;
#
# WL#10828: TIMESTAMP/DATETIME VALUES CAN INCLUDE TIMEZONE DETAILS
#
SET time_zone = '+01:00';
# Test of the format
SELECT TIMESTAMP'2015-01-01 10:10:10+05:30';
TIMESTAMP'2015-01-01 10:10:10+05:30'
2015-01-01 05:40:10
SELECT TIMESTAMP'2015-01-01 10:10:10.1+05:30';
TIMESTAMP'2015-01-01 10:10:10.1+05:30'
2015-01-01 05:40:10.1
SELECT TIMESTAMP'2015-01-01 10:10:10.01+05:30';
TIMESTAMP'2015-01-01 10:10:10.01+05:30'
2015-01-01 05:40:10.01
SELECT TIMESTAMP'2015-01-01 10:10:10.001+05:30';
TIMESTAMP'2015-01-01 10:10:10.001+05:30'
2015-01-01 05:40:10.001
SELECT TIMESTAMP'2015-01-01 10:10:10.0001+05:30';
TIMESTAMP'2015-01-01 10:10:10.0001+05:30'
2015-01-01 05:40:10.0001
SELECT TIMESTAMP'2015-01-01 10:10:10.00001+05:30';
TIMESTAMP'2015-01-01 10:10:10.00001+05:30'
2015-01-01 05:40:10.00001
SELECT TIMESTAMP'2015-01-01 10:10:10.000001+05:30';
TIMESTAMP'2015-01-01 10:10:10.000001+05:30'
2015-01-01 05:40:10.000001
SELECT TIMESTAMP'2015-01-01 10:10:10.0000001+05:30';
TIMESTAMP'2015-01-01 10:10:10.0000001+05:30'
2015-01-01 05:40:10.000000
SELECT TIMESTAMP'2015-01-01 10:10:10-05:30';
TIMESTAMP'2015-01-01 10:10:10-05:30'
2015-01-01 16:40:10
SELECT TIMESTAMP'2015-01-01 10:10:10.1-05:30';
TIMESTAMP'2015-01-01 10:10:10.1-05:30'
2015-01-01 16:40:10.1
SELECT TIMESTAMP'2015-01-01 10:10:10.01-05:30';
TIMESTAMP'2015-01-01 10:10:10.01-05:30'
2015-01-01 16:40:10.01
SELECT TIMESTAMP'2015-01-01 10:10:10.001-05:30';
TIMESTAMP'2015-01-01 10:10:10.001-05:30'
2015-01-01 16:40:10.001
SELECT TIMESTAMP'2015-01-01 10:10:10.0001-05:30';
TIMESTAMP'2015-01-01 10:10:10.0001-05:30'
2015-01-01 16:40:10.0001
SELECT TIMESTAMP'2015-01-01 10:10:10.00001-05:30';
TIMESTAMP'2015-01-01 10:10:10.00001-05:30'
2015-01-01 16:40:10.00001
SELECT TIMESTAMP'2015-01-01 10:10:10.000001-05:30';
TIMESTAMP'2015-01-01 10:10:10.000001-05:30'
2015-01-01 16:40:10.000001
SELECT TIMESTAMP'2015-01-01 10:10:10.0000001-05:30';
TIMESTAMP'2015-01-01 10:10:10.0000001-05:30'
2015-01-01 16:40:10.000000
SELECT TIMESTAMP'2015-01-01 10:10:10+5:30';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10+5:30'
SELECT TIMESTAMP'2015-01-01 10:10:10+5:030';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10+5:030'
SELECT TIMESTAMP'2015-01-01 10:10:10+005:30';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10+005:30'
SELECT TIMESTAMP'2001-01-01 00:00:00+02:00';
TIMESTAMP'2001-01-01 00:00:00+02:00'
2000-12-31 23:00:00
SELECT TIMESTAMP( '2001-01-01 00:00:00+02:00' );
TIMESTAMP( '2001-01-01 00:00:00+02:00' )
2000-12-31 23:00:00
SELECT TIMESTAMP'2015-01-01 10:10:10+05:300';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10+05:300'
SELECT TIMESTAMP'2015-01-01 10:10:10.0+05:300';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10.0+05:300'
SELECT TIMESTAMP'2015-01-01 10:10:10.0+05:30xxx';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10.0+05:30xxx'
SELECT TIMESTAMP'2015-01-01 10:10:10.0+25:30';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10.0+25:30'
SELECT TIMESTAMP'2015-01-01 10:10:10+05';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10+05'
SELECT TIMESTAMP'2015-01-01 10:10:10+05:';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10+05:'
SELECT TIMESTAMP'2015-01-01 10:10:10+0';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10+0'
SELECT TIMESTAMP'2015-01-01 10:10:10+1';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10+1'
# No extra space allowed before +/-
SELECT TIMESTAMP'2015-01-01 10:10:10 +05:30';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10 +05:30'
SELECT TIMESTAMP'2015-01-01 10:10:10+14:01';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10+14:01'
SELECT TIMESTAMP'2015-01-01 10:10:10-14:01';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10-14:01'
SELECT TIMESTAMP'2015-01-01 10:10:10+zx:00';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10+zx:00'
SELECT TIMESTAMP'2015-01-01 10:10:10+00:00zx';
ERROR HY000: Incorrect DATETIME value: '2015-01-01 10:10:10+00:00zx'
#
# The TIMESTAMP type.
#
SET time_zone = '+02:00';
CREATE TABLE t1 ( a TIMESTAMP DEFAULT '1995-05-05 00:00:00+05:30' );
INSERT INTO t1 VALUES ();
SELECT * FROM t1;
a
1995-05-04 20:30:00
DROP TABLE t1;
SET time_zone = '+01:00';
CREATE TABLE t1 (
id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
a TIMESTAMP NOT NULL
) AUTO_INCREMENT = 1;
INSERT INTO t1( a ) VALUES ( '2015-01-01 10:10:10' );
INSERT INTO t1( a ) VALUES ( '2015-01-01 10:10:10+05:30' );
# The valid timezone displacement range as prescribed by the
# sql standard is -14:00 to +14:00.
INSERT INTO t1( a ) VALUES ( '2015-01-01 10:10:10+14:00' );
INSERT INTO t1( a ) VALUES ( '2015-01-01 10:10:10-14:00' );
# Requirement F2.
SET @a = '2015-01-01 10:10:10+02:00';
PREPARE stmt1 FROM "INSERT INTO t1( a ) VALUES ( ? )";
EXECUTE stmt1 USING @a;
SELECT * FROM t1;
id	a
1	2015-01-01 10:10:10
2	2015-01-01 05:40:10
3	2014-12-31 21:10:10
4	2015-01-02 01:10:10
5	2015-01-01 09:10:10
# To see values stored in SE use UTC timezone.
SET time_zone = '+00:00';
INSERT INTO t1( a ) VALUES ( '2015-01-01 10:10:10' );
SELECT * FROM t1;
id	a
1	2015-01-01 09:10:10
2	2015-01-01 04:40:10
3	2014-12-31 20:10:10
4	2015-01-02 00:10:10
5	2015-01-01 08:10:10
6	2015-01-01 10:10:10
SET time_zone = '+03:00';
INSERT INTO t1( a ) VALUES ( '2015-01-01 10:10:10+02:00' );
SELECT * FROM t1;
id	a
1	2015-01-01 12:10:10
2	2015-01-01 07:40:10
3	2014-12-31 23:10:10
4	2015-01-02 03:10:10
5	2015-01-01 11:10:10
6	2015-01-01 13:10:10
7	2015-01-01 11:10:10
# Make sure comparisions work correctly for TIMESTAMP.
SET time_zone = '+05:30';
SELECT * FROM t1;
id	a
1	2015-01-01 14:40:10
2	2015-01-01 10:10:10
3	2015-01-01 01:40:10
4	2015-01-02 05:40:10
5	2015-01-01 13:40:10
6	2015-01-01 15:40:10
7	2015-01-01 13:40:10
SELECT * FROM t1 WHERE a = '2015-01-01 10:10:10+03:30';
id	a
SELECT * FROM t1 WHERE a = '2015-01-01 10:10:10+02:00';
id	a
5	2015-01-01 13:40:10
7	2015-01-01 13:40:10
SELECT * FROM t1 WHERE a = '2015-01-01 10:10:10+05:30';
id	a
2	2015-01-01 10:10:10
SET time_zone = '+00:00';
SELECT * FROM t1;
id	a
1	2015-01-01 09:10:10
2	2015-01-01 04:40:10
3	2014-12-31 20:10:10
4	2015-01-02 00:10:10
5	2015-01-01 08:10:10
6	2015-01-01 10:10:10
7	2015-01-01 08:10:10
SELECT * FROM t1 WHERE a = '2015-01-01 10:10:10+03:30';
id	a
SELECT * FROM t1 WHERE a = '2015-01-01 10:10:10+02:00';
id	a
5	2015-01-01 08:10:10
7	2015-01-01 08:10:10
SELECT * FROM t1 WHERE a = '2015-01-01 10:10:10+05:30';
id	a
2	2015-01-01 04:40:10
SET time_zone = DEFAULT;
DROP TABLE t1;
SET time_zone = '+01:00';
CREATE TABLE t1 ( a TIMESTAMP(1) );
INSERT INTO t1 VALUES ( TIMESTAMP'2015-01-01 10:10:10.1+05:30' );
SELECT * FROM t1 WHERE a = '2015-01-01 05:40:10.1';
a
2015-01-01 05:40:10.1
DROP TABLE t1;
CREATE TABLE t1 ( a TIMESTAMP(2) );
INSERT INTO t1 VALUES ( TIMESTAMP'2015-01-01 10:10:10.01+05:30' );
SELECT * FROM t1 WHERE a = '2015-01-01 05:40:10.01';
a
2015-01-01 05:40:10.01
DROP TABLE t1;
CREATE TABLE t1 ( a TIMESTAMP(3) );
INSERT INTO t1 VALUES ( TIMESTAMP'2015-01-01 10:10:10.001+05:30' );
SELECT * FROM t1 WHERE a = '2015-01-01 05:40:10.001';
a
2015-01-01 05:40:10.001
DROP TABLE t1;
CREATE TABLE t1 ( a TIMESTAMP(4) );
INSERT INTO t1 VALUES ( TIMESTAMP'2015-01-01 10:10:10.0001+05:30' );
SELECT * FROM t1 WHERE a = '2015-01-01 05:40:10.0001';
a
2015-01-01 05:40:10.0001
DROP TABLE t1;
CREATE TABLE t1 ( a TIMESTAMP(5) );
INSERT INTO t1 VALUES ( TIMESTAMP'2015-01-01 10:10:10.00001+05:30' );
SELECT * FROM t1 WHERE a = '2015-01-01 05:40:10.00001';
a
2015-01-01 05:40:10.00001
DROP TABLE t1;
CREATE TABLE t1 ( a TIMESTAMP(6) );
INSERT INTO t1 VALUES ( TIMESTAMP'2015-01-01 10:10:10.000001+05:30' );
SELECT * FROM t1 WHERE a = '2015-01-01 05:40:10.000001';
a
2015-01-01 05:40:10.000001
DROP TABLE t1;
#
# The DATETIME type.
#
SET time_zone = '+02:00';
CREATE TABLE t2 ( a DATETIME DEFAULT '1995-05-05 00:00:00+05:30' );
INSERT INTO t2 VALUES ();
SELECT * FROM t2;
a
1995-05-04 20:30:00
DROP TABLE t2;
CREATE TABLE t2 (
id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
a DATETIME NOT NULL
) AUTO_INCREMENT = 1;
INSERT INTO t2 ( a ) VALUES ( '2015-01-01 10:10:10' );
SELECT * FROM t2;
id	a
1	2015-01-01 10:10:10
# No effect of time_zone on the stored values of DATETIME datatype.
SET time_zone = '+05:30';
INSERT INTO t2 ( a ) VALUES ( '2015-01-01 10:10:10+05:30' );
INSERT INTO t2 ( a ) VALUES ( '2015-01-01 10:10:10+00:00' );
SELECT * FROM t2;
id	a
1	2015-01-01 10:10:10
2	2015-01-01 10:10:10
3	2015-01-01 15:40:10
SET time_zone = '+02:00';
INSERT INTO t2 ( a ) VALUES ( '2015-01-01 10:10:10+03:00' );
SELECT * FROM t2;
id	a
1	2015-01-01 10:10:10
2	2015-01-01 10:10:10
3	2015-01-01 15:40:10
4	2015-01-01 09:10:10
# Make sure comparisions work correctly for DATETIME.
SET time_zone = '+05:30';
SELECT * FROM t2;
id	a
1	2015-01-01 10:10:10
2	2015-01-01 10:10:10
3	2015-01-01 15:40:10
4	2015-01-01 09:10:10
SELECT * FROM t2 WHERE a = '2015-01-01 10:10:10+03:30';
id	a
SELECT * FROM t2 WHERE a = '2015-01-01 10:10:10+02:00';
id	a
SELECT * FROM t2 WHERE a = '2015-01-01 10:10:10+05:30';
id	a
1	2015-01-01 10:10:10
2	2015-01-01 10:10:10
SET time_zone = '+00:00';
SELECT * FROM t2;
id	a
1	2015-01-01 10:10:10
2	2015-01-01 10:10:10
3	2015-01-01 15:40:10
4	2015-01-01 09:10:10
SELECT * FROM t2 WHERE a = '2015-01-01 10:10:10+03:30';
id	a
SELECT * FROM t2 WHERE a = '2015-01-01 10:10:10+02:00';
id	a
SELECT * FROM t2 WHERE a = '2015-01-01 10:10:10+05:30';
id	a
SET time_zone = DEFAULT;
# Negative test case in Item_func_add_time::val_datetime.
# Second argument shouldn't have datetime + timezone info.
SELECT ADDTIME( '2001-01-01 00:00:00+02:00', '2001-01-01 00:00:00+02:00' );
ADDTIME( '2001-01-01 00:00:00+02:00', '2001-01-01 00:00:00+02:00' )
NULL
SET time_zone = '+05:30';
SELECT CAST( '2001-01-01 00:00:00+02:00' AS DATETIME );
CAST( '2001-01-01 00:00:00+02:00' AS DATETIME )
2001-01-01 03:30:00
SELECT ADDTIME( TIMESTAMP'2001-01-01 00:00:00+02:00', '00:00:00.123456' );
ADDTIME( TIMESTAMP'2001-01-01 00:00:00+02:00', '00:00:00.123456' )
2001-01-01 03:30:00.123456
SELECT CONVERT_TZ( '2015-01-01 10:10:10','+00:00','+05:00' );
CONVERT_TZ( '2015-01-01 10:10:10','+00:00','+05:00' )
2015-01-01 15:10:10
SELECT CONVERT_TZ( '2015-01-01 10:10:10+02:00','+00:00','+05:00' );
CONVERT_TZ( '2015-01-01 10:10:10+02:00','+00:00','+05:00' )
2015-01-01 18:40:10
SELECT TO_DAYS( '2001-01-01 00:00:00+07:00' );
TO_DAYS( '2001-01-01 00:00:00+07:00' )
730850
SELECT TO_DAYS( '2001-01-01 00:00:00-07:00' );
TO_DAYS( '2001-01-01 00:00:00-07:00' )
730851
SELECT DATEDIFF( '2007-12-31 23:59:59+02:00', '2007-12-30  00:00:00' );
DATEDIFF( '2007-12-31 23:59:59+02:00', '2007-12-30  00:00:00' )
2
Warnings:
Warning	4096	Delimiter ' ' in position 11 in datetime value '2007-12-30  00:00:00' at row 1 is superfluous and is deprecated. Please remove.
SELECT TIMEDIFF( '2000:01:01 00:00:00+02:00',
'2000:01:01 00:00:00.000001+01:00' );
TIMEDIFF( '2000:01:01 00:00:00+02:00',
'2000:01:01 00:00:00.000001+01:00' )
-01:00:00.000001
Warnings:
Warning	4095	Delimiter ':' in position 4 in datetime value '2000:01:01 00:00:00+02:00' at row 1 is deprecated. Prefer the standard '-'.
Warning	4095	Delimiter ':' in position 4 in datetime value '2000:01:01 00:00:00.000001+01:00' at row 1 is deprecated. Prefer the standard '-'.
SELECT DATE_ADD( '2000-12-31 23:59:59+02:00', INTERVAL 1 SECOND );
DATE_ADD( '2000-12-31 23:59:59+02:00', INTERVAL 1 SECOND )
2001-01-01 03:30:00
SELECT DATE_SUB( '2000-12-31 23:59:59+02:00', INTERVAL 1 SECOND );
DATE_SUB( '2000-12-31 23:59:59+02:00', INTERVAL 1 SECOND )
2001-01-01 03:29:58
SELECT DATE_FORMAT( '2009-10-10 23:59:59+02:00', '%W %M %Y' );
DATE_FORMAT( '2009-10-10 23:59:59+02:00', '%W %M %Y' )
Sunday October 2009
SELECT TIME( '2003-12-31 23:59:59+02:00' );
TIME( '2003-12-31 23:59:59+02:00' )
03:29:59
SELECT TIMESTAMP( '2003-12-31 23:59:59+02:00', '12:00:00' );
TIMESTAMP( '2003-12-31 23:59:59+02:00', '12:00:00' )
2004-01-01 15:29:59
SELECT TIMESTAMPADD(MINUTE, 1, '2003-01-02 23:59:59+02:00' );
TIMESTAMPADD(MINUTE, 1, '2003-01-02 23:59:59+02:00' )
2003-01-03 03:30:59
SELECT TIMESTAMPDIFF(MONTH, '2003-02-01 23:59:59+02:00', '2003-05-01' );
TIMESTAMPDIFF(MONTH, '2003-02-01 23:59:59+02:00', '2003-05-01' )
2
SELECT TO_SECONDS( '2009-11-29 23:59:59+02:00' );
TO_SECONDS( '2009-11-29 23:59:59+02:00' )
63426770999
SELECT UNIX_TIMESTAMP( '2015-11-13 23:59:59+02:00' );
UNIX_TIMESTAMP( '2015-11-13 23:59:59+02:00' )
1447451999
# Change of time_zone should give different results.
SET time_zone = '+00:00';
SELECT TIMESTAMP'2001-01-01 00:00:00+02:00';
TIMESTAMP'2001-01-01 00:00:00+02:00'
2000-12-31 22:00:00
SELECT TIMESTAMP( '2001-01-01 00:00:00+02:00' );
TIMESTAMP( '2001-01-01 00:00:00+02:00' )
2000-12-31 22:00:00
SELECT CAST( '2001-01-01 00:00:00+02:00' AS DATETIME);
CAST( '2001-01-01 00:00:00+02:00' AS DATETIME)
2000-12-31 22:00:00
SELECT ADDTIME(TIMESTAMP'2001-01-01 00:00:00+02:00', '00:00:00.123456' );
ADDTIME(TIMESTAMP'2001-01-01 00:00:00+02:00', '00:00:00.123456' )
2000-12-31 22:00:00.123456
SELECT CONVERT_TZ( '2015-01-01 10:10:10', '+00:00', '+05:00' );
CONVERT_TZ( '2015-01-01 10:10:10', '+00:00', '+05:00' )
2015-01-01 15:10:10
SELECT CONVERT_TZ( '2015-01-01 10:10:10+02:00', '+00:00', '+05:00' );
CONVERT_TZ( '2015-01-01 10:10:10+02:00', '+00:00', '+05:00' )
2015-01-01 13:10:10
SELECT TO_DAYS( '2001-01-01 00:00:00+07:00' );
TO_DAYS( '2001-01-01 00:00:00+07:00' )
730850
SELECT TO_DAYS( '2001-01-01 00:00:00-07:00' );
TO_DAYS( '2001-01-01 00:00:00-07:00' )
730851
SELECT DATEDIFF( '2007-12-31 23:59:59+02:00', '2007-12-30  00:00:00' );
DATEDIFF( '2007-12-31 23:59:59+02:00', '2007-12-30  00:00:00' )
1
Warnings:
Warning	4096	Delimiter ' ' in position 11 in datetime value '2007-12-30  00:00:00' at row 1 is superfluous and is deprecated. Please remove.
SELECT TIMEDIFF( '2000:01:01 00:00:00+02:00',
'2000:01:01 00:00:00.000001+01:00' );
TIMEDIFF( '2000:01:01 00:00:00+02:00',
'2000:01:01 00:00:00.000001+01:00' )
-01:00:00.000001
Warnings:
Warning	4095	Delimiter ':' in position 4 in datetime value '2000:01:01 00:00:00+02:00' at row 1 is deprecated. Prefer the standard '-'.
Warning	4095	Delimiter ':' in position 4 in datetime value '2000:01:01 00:00:00.000001+01:00' at row 1 is deprecated. Prefer the standard '-'.
SELECT DATE_ADD( '2000-12-31 23:59:59+02:00', INTERVAL 1 SECOND);
DATE_ADD( '2000-12-31 23:59:59+02:00', INTERVAL 1 SECOND)
2000-12-31 22:00:00
SELECT DATE_SUB( '2000-12-31 23:59:59+02:00', INTERVAL 1 SECOND);
DATE_SUB( '2000-12-31 23:59:59+02:00', INTERVAL 1 SECOND)
2000-12-31 21:59:58
SELECT DATE_FORMAT( '2009-10-10 23:59:59+02:00', '%W %M %Y' );
DATE_FORMAT( '2009-10-10 23:59:59+02:00', '%W %M %Y' )
Saturday October 2009
SELECT TIME( '2003-12-31 23:59:59+02:00' );
TIME( '2003-12-31 23:59:59+02:00' )
21:59:59
SELECT TIMESTAMP( '2003-12-31 23:59:59+02:00', '12:00:00' );
TIMESTAMP( '2003-12-31 23:59:59+02:00', '12:00:00' )
2004-01-01 09:59:59
SELECT TIMESTAMPADD(MINUTE, 1, '2003-01-02 23:59:59+02:00' );
TIMESTAMPADD(MINUTE, 1, '2003-01-02 23:59:59+02:00' )
2003-01-02 22:00:59
SELECT TIMESTAMPDIFF(MONTH, '2003-02-01 23:59:59+02:00', '2003-05-01' );
TIMESTAMPDIFF(MONTH, '2003-02-01 23:59:59+02:00', '2003-05-01' )
2
SELECT TO_SECONDS( '2009-11-29 23:59:59+02:00' );
TO_SECONDS( '2009-11-29 23:59:59+02:00' )
63426751199
SELECT UNIX_TIMESTAMP( '2015-11-13 23:59:59+02:00' );
UNIX_TIMESTAMP( '2015-11-13 23:59:59+02:00' )
1447451999
DROP TABLE t2;
CREATE TABLE t2 ( a DATETIME(1) );
INSERT INTO t2 VALUES ( '2015-01-01 10:10:10.1+05:30' );
SELECT * FROM t2 WHERE a = '2015-01-01 04:40:10.1';
a
2015-01-01 04:40:10.1
DROP TABLE t2;
CREATE TABLE t2 ( a DATETIME(2) );
INSERT INTO t2 VALUES ( '2015-01-01 10:10:10.01+05:30' );
SELECT * FROM t2 WHERE a = '2015-01-01 04:40:10.01';
a
2015-01-01 04:40:10.01
DROP TABLE t2;
CREATE TABLE t2 ( a DATETIME(3) );
INSERT INTO t2 VALUES ( '2015-01-01 10:10:10.001+05:30' );
SELECT * FROM t2 WHERE a = '2015-01-01 04:40:10.001';
a
2015-01-01 04:40:10.001
DROP TABLE t2;
CREATE TABLE t2 ( a DATETIME(4) );
INSERT INTO t2 VALUES ( '2015-01-01 10:10:10.0001+05:30' );
SELECT * FROM t2 WHERE a = '2015-01-01 04:40:10.0001';
a
2015-01-01 04:40:10.0001
DROP TABLE t2;
CREATE TABLE t2 ( a DATETIME(5) );
INSERT INTO t2 VALUES ( '2015-01-01 10:10:10.00001+05:30' );
SELECT * FROM t2 WHERE a = '2015-01-01 04:40:10.00001';
a
2015-01-01 04:40:10.00001
DROP TABLE t2;
CREATE TABLE t2 ( a DATETIME(6) );
INSERT INTO t2 VALUES ( '2015-01-01 10:10:10.000001+05:30' );
SELECT * FROM t2 WHERE a = '2015-01-01 04:40:10.000001';
a
2015-01-01 04:40:10.000001
DROP TABLE t2;
SET time_zone = DEFAULT;
#
# Bug#31239157: NO BOUNDS CHECK FOR TIMESTAMPS WITH TIME ZONE
# DISPLACEMENT
#
# This is needed to check the below boundary case when time zone
# adjustment causes a value to be outside the DATETIME range.
SET time_zone = CET;
CREATE TABLE t1 ( a TIMESTAMP );
CREATE TABLE t2 ( a TIMESTAMP(6) );
INSERT INTO t1 VALUES ( TIMESTAMP'2038-01-19 03:14:08+00:00' );
ERROR 22007: Incorrect datetime value: 'X' for column 'a' at row 1
INSERT INTO t1 VALUES ( TIMESTAMP'2038-01-19 03:14:07+00:00' );
INSERT INTO t1 VALUES ( TIMESTAMP'2038-01-19 03:14:07.000001+00:00' );
INSERT INTO t1 VALUES ( TIMESTAMP'2038-01-19 03:14:07.999999+00:00' );
ERROR 22007: Incorrect datetime value: '2038-01-19 04:14:08' for column 'a' at row 1
INSERT INTO t1 VALUES ( TIMESTAMP'1970-01-01 00:00:00.000000+00:00' );
ERROR 22007: Incorrect datetime value: '1970-01-01 01:00:00' for column 'a' at row 1
INSERT INTO t1 VALUES ( TIMESTAMP'1970-01-01 01:00:00.000000+00:00' );
INSERT INTO t1 VALUES ( TIMESTAMP'1970-01-01 00:00:01.000000+00:00' );
INSERT INTO t1 VALUES ( TIMESTAMP'1970-01-01 00:00:00.000001+00:00' );
ERROR 22007: Incorrect datetime value: '1970-01-01 01:00:00' for column 'a' at row 1
INSERT INTO t1 VALUES ( TIMESTAMP'1970-01-01 00:00:00.999999+00:00' );
INSERT INTO t1 VALUES ( '2038-01-19 03:14:08+00:00' );
ERROR 22007: Incorrect datetime value: '2038-01-19 03:14:08+00:00' for column 'a' at row 1
INSERT INTO t1 VALUES ( TIMESTAMP'9999-12-31 23:59:59.999999+00:00' );
Got one of the listed errors
INSERT INTO t1 VALUES ( '9999-12-31 23:59:59.999999+00:00' );
Got one of the listed errors
INSERT INTO t2 VALUES ( TIMESTAMP'2038-01-19 03:14:08+00:00' );
ERROR 22007: Incorrect datetime value: 'X' for column 'a' at row 1
INSERT INTO t2 VALUES ( TIMESTAMP'2038-01-19 03:14:07+00:00' );
INSERT INTO t2 VALUES ( TIMESTAMP'2038-01-19 03:14:07.000001+00:00' );
INSERT INTO t2 VALUES ( TIMESTAMP'2038-01-19 03:14:07.999999+00:00' );
INSERT INTO t2 VALUES ( TIMESTAMP'1970-01-01 00:00:00.000000+00:00' );
ERROR 22007: Incorrect datetime value: '1970-01-01 01:00:00.000000' for column 'a' at row 1
INSERT INTO t2 VALUES ( TIMESTAMP'1970-01-01 01:00:00.000000+00:00' );
INSERT INTO t2 VALUES ( TIMESTAMP'1970-01-01 00:00:01.000000+00:00' );
INSERT INTO t2 VALUES ( TIMESTAMP'1970-01-01 00:00:00.000001+00:00' );
ERROR 22007: Incorrect datetime value: '1970-01-01 01:00:00.000001' for column 'a' at row 1
INSERT INTO t2 VALUES ( TIMESTAMP'1970-01-01 00:00:00.999999+00:00' );
ERROR 22007: Incorrect datetime value: '1970-01-01 01:00:00.999999' for column 'a' at row 1
INSERT INTO t2 VALUES ( '2038-01-19 03:14:08+00:00' );
ERROR 22007: Incorrect datetime value: '2038-01-19 03:14:08+00:00' for column 'a' at row 1
INSERT INTO t2 VALUES ( TIMESTAMP'9999-12-31 23:59:59.999999+00:00' );
Got one of the listed errors
INSERT INTO t2 VALUES ( '9999-12-31 23:59:59.999999+00:00' );
Got one of the listed errors
SET time_zone = UTC;
INSERT INTO t1 VALUES ( '2038-01-19 03:14:08+00:00' );
ERROR 22007: Incorrect datetime value: '2038-01-19 03:14:08+00:00' for column 'a' at row 1
INSERT INTO t1 VALUES ( '2038-01-19 03:14:08' );
ERROR 22007: Incorrect datetime value: '2038-01-19 03:14:08' for column 'a' at row 1
SET sql_mode = '';
# Tests that we can handle years which are negative wrt. the epoch.
INSERT INTO t1 VALUES ( '1969-12-31 23:59:59' );
Warnings:
Warning	1264	Out of range value for column 'a' at row 1
SET sql_mode = DEFAULT;
SELECT * FROM t1;
a
2038-01-19 03:14:07
2038-01-19 03:14:07
1970-01-01 01:00:00
1970-01-01 00:00:01
1970-01-01 00:00:01
0000-00-00 00:00:00
SELECT * FROM t2;
a
2038-01-19 03:14:07.000000
2038-01-19 03:14:07.000001
2038-01-19 03:14:07.999999
1970-01-01 01:00:00.000000
1970-01-01 00:00:01.000000
SET time_zone = DEFAULT;
DROP TABLE t1, t2;
#
# Bug#30786762: FAILED ASSERTION FOR DATES WITH ZERO OR ABOVE TIMESTAMP
# LIMIT
#
SET sql_mode = regexp_replace(@@sql_mode, 'NO_ZERO_IN_DATE', '');
Warnings:
Warning	3135	'NO_ZERO_DATE', 'NO_ZERO_IN_DATE' and 'ERROR_FOR_DIVISION_BY_ZERO' sql modes should be used with strict mode. They will be merged with strict mode in a future release.
SELECT TIMESTAMP '2020-00-01 08:00:00.123456+00:00';
ERROR 22007: Truncated incorrect temporal value: '2020-00-01 08:00:00+0:00'
SELECT TIMESTAMP '2020-01-00 08:00:00.123456+00:00';
ERROR 22007: Truncated incorrect temporal value: '2020-01-00 08:00:00+0:00'
CREATE TABLE t1 ( a DATETIME(6) );
INSERT INTO t1 VALUES ( '2020-00-01 00:00:00.123456+00:00' );
ERROR 22007: Truncated incorrect temporal value: '2020-00-01 00:00:00+0:00'
INSERT INTO t1 VALUES ( '2020-01-00 00:00:00.123456+00:00' );
ERROR 22007: Truncated incorrect temporal value: '2020-01-00 00:00:00+0:00'
SELECT * FROM t1 WHERE a = '2020-00-01 00:00:00.123456+00:00';
ERROR 22007: Truncated incorrect temporal value: '2020-00-01 00:00:00+0:00'
SELECT * FROM t1 WHERE a = '2020-01-00 00:00:00.123456+00:00';
ERROR 22007: Truncated incorrect temporal value: '2020-01-00 00:00:00+0:00'
DROP TABLE t1;
SET sql_mode = DEFAULT;
