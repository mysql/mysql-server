CREATE TABLE t1 (i INT, j INT);
CREATE INDEX i1 ON t1(i);
CREATE INDEX i2 ON t1(j);

# empty hint comment is ok:

SELECT /*+*/ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '*/' at line 1
SELECT /*+ */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '*/' at line 1
SELECT /*+ * ** / // /* */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '* ** / // /* */ 1' at line 1
SELECT /*+ @ */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '@ */ 1' at line 1
SELECT /*+ @foo */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '@foo */ 1' at line 1
SELECT /*+ foo@bar */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near 'foo@bar */ 1' at line 1
SELECT /*+ foo @bar */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near 'foo @bar */ 1' at line 1
SELECT /*+ `@` */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '@` */ 1' at line 1
SELECT /*+ `@foo` */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '@foo` */ 1' at line 1
SELECT /*+ `foo@bar` */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near 'foo@bar` */ 1' at line 1
SELECT /*+ `foo @bar` */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near 'foo @bar` */ 1' at line 1
SELECT /*+ DEBUG_HINT1( @) */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near ') */ 1' at line 1
SELECT /*+ DEBUG_HINT1( @) */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near ') */ 1' at line 1
SELECT /*+ DEBUG_HINT1(t1 @) */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '@) */ 1' at line 1

# We don't support "*/" inside quoted identifiers (syntax error):

SELECT /*+ DEBUG_HINT(`test*/`) */ 1;
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '`) */ 1' at line 1

# valid hint sequences:

SELECT  /*+ DEBUG_HINT2() */ 1;
1
1
SELECT  /*+DEBUG_HINT2()*/ 1;
1
1
SELECT  /*+ DEBUG_HINT2 () */ 1;
1
1
SELECT  /*+ DEBUG_HINT2 (  ) */ 1;
1
1
SELECT  /*+ DEBUG_HINT2() */ 1 UNION SELECT 1;
1
1
(SELECT /*+ DEBUG_HINT2() */ 1) UNION (SELECT 1);
1
1
((SELECT  /* + DEBUG_HINT2() */ 1));
1
1
UPDATE  /*+ DEBUG_HINT2() */ t1 SET i = 10;
INSERT  /*+ DEBUG_HINT2() */ INTO t1 VALUES ();
REPLACE /*+ DEBUG_HINT2() */ INTO t1 VALUES ();
DELETE  /*+ DEBUG_HINT2() */ FROM t1 WHERE 1;
SELECT /*+ DEBUG_HINT1(t1) */    1 FROM t1;
1
SELECT /*+ DEBUG_HINT1(a b) */   1 FROM t1 a, t1 b;
1
SELECT /*+ DEBUG_HINT2(i1) */ 1 FROM t1;
1
SELECT /*+ DEBUG_HINT2(i1 i2) */ 1 FROM t1;
1
#
# test explainable statements for hint support:
# they should warn with a hint syntax error near "test */"
#
EXPLAIN SELECT /*+ test */ 1;
id	select_type	table	partitions	type	possible_keys	key	key_len	ref	rows	filtered	Extra
1	SIMPLE	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	No tables used
Warnings:
Warning	1064	Optimizer hint syntax error near 'test */ 1' at line 1
Note	1003	/* select#1 */ select 1 AS `1`
EXPLAIN INSERT /*+ test */ INTO t1 VALUES (10, 10);
id	select_type	table	partitions	type	possible_keys	key	key_len	ref	rows	filtered	Extra
1	INSERT	t1	NULL	ALL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
Warnings:
Warning	1064	Optimizer hint syntax error near 'test */ INTO t1 VALUES (10, 10)' at line 1
EXPLAIN REPLACE /*+ test */ INTO t1 VALUES (10, 10);
id	select_type	table	partitions	type	possible_keys	key	key_len	ref	rows	filtered	Extra
1	REPLACE	t1	NULL	ALL	NULL	NULL	NULL	NULL	NULL	NULL	NULL
Warnings:
Warning	1064	Optimizer hint syntax error near 'test */ INTO t1 VALUES (10, 10)' at line 1
EXPLAIN UPDATE /*+ test */ t1 SET i = 10 WHERE j = 10;
id	select_type	table	partitions	type	possible_keys	key	key_len	ref	rows	filtered	Extra
1	UPDATE	t1	NULL	range	i2	i2	5	const	1	100.00	Using where
Warnings:
Warning	1064	Optimizer hint syntax error near 'test */ t1 SET i = 10 WHERE j = 10' at line 1
EXPLAIN DELETE /*+ test */ FROM t1 WHERE i = 10;
id	select_type	table	partitions	type	possible_keys	key	key_len	ref	rows	filtered	Extra
1	DELETE	t1	NULL	range	i1	i1	5	const	1	100.00	Using where
Warnings:
Warning	1064	Optimizer hint syntax error near 'test */ FROM t1 WHERE i = 10' at line 1

# non-alphabetic and non-ASCII identifiers:

CREATE INDEX 3rd_index ON t1(i, j);
SELECT /*+ DEBUG_HINT2(3rd_index) */ 1 FROM t1;
1
CREATE INDEX $index ON t1(j, i);
SELECT /*+ DEBUG_HINT2($index) */ 1 FROM t1;
1
CREATE TABLE ` quoted name —Ç–µ—Å—Ç` (i INT);
SELECT /*+ DEBUG_HINT1(` quoted name —Ç–µ—Å—Ç`) */ 1 FROM t1;
1
SELECT /*+ DEBUG_HINT1(` quoted name —Ç–µ—Å—Ç`@`select#1`) */ 1 FROM t1;
1
DROP TABLE ` quoted name —Ç–µ—Å—Ç`;
SET SQL_MODE = 'ANSI_QUOTES';
CREATE TABLE " quoted name —Ç–µ—Å—Ç" (i INT);
SELECT /*+ DEBUG_HINT1(" quoted name —Ç–µ—Å—Ç") */ 1 FROM t1;
1
SELECT /*+ DEBUG_HINT1(" quoted name —Ç–µ—Å—Ç"@"select#1") */ 1 FROM t1;
1
CREATE TABLE `test1``test2``` (i INT);
SELECT /*+ DEBUG_HINT1(`test1``test2```) */ 1;
1
1
SELECT /*+ DEBUG_HINT1("test1""test2""") */ 1;
1
1
SET SQL_MODE = '';
# should warn:
SELECT /*+ DEBUG_HINT1(" quoted name —Ç–µ—Å—Ç") */ 1 FROM t1;
1
Warnings:
Warning	1064	Optimizer hint syntax error near '" quoted name —Ç–µ—Å—Ç") */ 1 FROM t1' at line 1
DROP TABLE ` quoted name —Ç–µ—Å—Ç`;
DROP TABLE `test1``test2```;
SET NAMES utf8;
CREATE TABLE table–¢ (i INT);
SELECT /*+ DEBUG_HINT1(table–¢) */ 1 FROM t1;
1
SELECT /*+ DEBUG_HINT1(test@table–¢) */ 1 FROM t1;
1
DROP TABLE table–¢;
CREATE TABLE —Ç–∞–±–ª–∏—Ü–∞ (i INT);
SELECT /*+ DEBUG_HINT1(`—Ç–∞–±–ª–∏—Ü–∞`) */ 1 FROM t1;
1
SELECT /*+ DEBUG_HINT1(—Ç–∞–±–ª–∏—Ü–∞) */ 1 FROM t1;
1
SELECT /*+ DEBUG_HINT1(test@—Ç–∞–±–ª–∏—Ü–∞) */ 1 FROM t1;
1
# broken multibyte char, should warn:
SELECT /*+ DEBUG_HINT1(`—`) */ 1 FROM t1;
1
Warnings:
Warning	1064	Optimizer hint syntax error near '?`) */ 1 FROM t1' at line 1
DROP TABLE —Ç–∞–±–ª–∏—Ü–∞;

# test the MAX_EXECUTION_TIME hint for SELECT statements:

INSERT INTO t1 VALUES (1, 1), (2, 2);
SELECT /*+ MAX_EXECUTION_TIME(1) */ *, SLEEP(1000) FROM t1;
ERROR HY000: Query execution was interrupted, max_statement_time exceeded
SELECT  /*+ MAX_EXECUTION_TIME(1) */ *, SLEEP(1000) FROM t1 UNION SELECT 1, 2, 3;
ERROR HY000: Query execution was interrupted, max_statement_time exceeded
(SELECT /*+ MAX_EXECUTION_TIME(1) */ *, SLEEP(1000) FROM t1) UNION (SELECT 1, 2, 3);
ERROR HY000: Query execution was interrupted, max_statement_time exceeded
((SELECT  /*+ MAX_EXECUTION_TIME(1) */ *, SLEEP(1000) FROM t1));
ERROR HY000: Query execution was interrupted, max_statement_time exceeded

# only SELECT statements supports the MAX_EXECUTION_TIME hint (warning):

CREATE TABLE t2 (i INT);
INSERT /*+ MAX_EXECUTION_TIME(1) */ INTO t2 SELECT 1;
Warnings:
Warning	3125	MAX_EXECUTION_TIME hint is supported by SELECT statements only
REPLACE /*+ MAX_EXECUTION_TIME(1) */ INTO t2 SELECT 1;
Warnings:
Warning	3125	MAX_EXECUTION_TIME hint is supported by SELECT statements only
UPDATE /*+ MAX_EXECUTION_TIME(1) */ t2 SET i = 1;
Warnings:
Warning	3125	MAX_EXECUTION_TIME hint is supported by SELECT statements only
DELETE /*+ MAX_EXECUTION_TIME(1) */ FROM t2 WHERE i = 1;
Warnings:
Warning	3125	MAX_EXECUTION_TIME hint is supported by SELECT statements only

# derived tables and other subqueries:

SELECT * FROM (SELECT /*+ DEBUG_HINT3 */ 1) a;
1
1
Warnings:
Warning	1064	This warning is expected near 'DEBUG_HINT3 */ 1) a' at line 1
SELECT (SELECT /*+ DEBUG_HINT3 */ 1);
(SELECT /*+ DEBUG_HINT3 */ 1)
1
Warnings:
Warning	1064	This warning is expected near 'DEBUG_HINT3 */ 1)' at line 1
SELECT 1 FROM DUAL WHERE 1 IN (SELECT /*+ DEBUG_HINT3 */ 1);
1
1
Warnings:
Warning	1064	This warning is expected near 'DEBUG_HINT3 */ 1)' at line 1

# invalid hint sequences (should warn):

SELECT /*+ 10 */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '10 */ 1' at line 1
SELECT /*+ DEBUG_HINT1() */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near ') */ 1' at line 1
SELECT /*+ DEBUG_HINT1(10) */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '10) */ 1' at line 1
SELECT /*+ DEBUG_HINT1( */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '*/' at line 1
SELECT /*+ DEBUG_HINT1) */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near ') */ 1' at line 1
SELECT /*+ DEBUG_HINT1(t1 */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '*/' at line 1
SELECT /*+ DEBUG_HINT1(t1 ( */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '( */ 1' at line 1
(SELECT 1) UNION (SELECT /*+ DEBUG_HINT2() */ 1);
1
1

# wrong place for hint, so recognize that stuff as a regular commentary:

SELECT 1 FROM /*+ regular commentary, not a hint! */ t1;
1
1
1
SELECT 1 FROM /*+ #1 */ t1 WHERE /*+ #2 */ 1 /*+ #3 */;
1
1
1
SELECT /*+ DEBUG_HINT2() */ 1
FROM /*+ regular commentary, not a hint! */ t1;
1
1
1
DROP TABLE t1, t2;
SELECT /*+ 10;
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '' at line 1
