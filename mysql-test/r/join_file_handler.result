#
# Bug#28039829: SELECT QUERY WITH COMPLEX JOINS LEAKS FILE HANDLES
#
CREATE DATABASE db_28039829;
USE db_28039829;
CREATE TABLE t1 (c1 CHAR(36) NOT NULL,
c2 CHAR(36) DEFAULT NULL,
c3 VARCHAR(100) DEFAULT NULL,
c4 VARCHAR(100) DEFAULT NULL,
PRIMARY KEY (c1),
KEY idx_1 (c2),
KEY idx_2 (c3, c4),
KEY idx_3 (c4, c3))
ENGINE=InnoDB;
CREATE TABLE t2 (c1 CHAR(36) DEFAULT NULL)
ENGINE=InnoDB DEFAULT CHARSET=utf8;
LOAD DATA INFILE '../../std_data/bug28039829.dat' INTO TABLE t1;
INSERT INTO t2 VALUES ('63dfcd94-143a-11e7-bec8-fa163e4dd901'),
('dcda6718-143a-11e7-82e5-fa163e4dd901');
SET optimizer_switch="block_nested_loop=OFF";
SELECT t1.c1 FROM t1 INNER JOIN t2 ON t1.c2 = t2.c1
WHERE (t1.c3 LIKE 'James' OR t1.c4 LIKE 'abc');
c1
0e6a4474-9703-11e7-bb28-fa163e8624cc
116be260-96f2-11e7-bc89-fa163e8624cc
1b1857e4-8a3b-11e7-9579-fa163e8624cc
458320fe-0b1e-11e8-b68a-fa163e8624cc
6f002136-0ff9-11e8-9fab-fa163e8624cc
767eb9fe-fcfd-11e7-98ee-fa163e8624cc
98c2aebe-0a57-11e8-8111-fa163e8624cc
DROP TABLE t1, t2;
DROP DATABASE db_28039829;
SET optimizer_switch=DEFAULT;
