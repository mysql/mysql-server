set default_storage_engine='tokudb';
drop table if exists t;
CREATE TABLE `t` (id bigint not null auto_increment primary key, val bigint not null default 0);
INSERT INTO t (id) values (null);
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
INSERT INTO t SELECT null,val FROM t;
SELECT count(*) FROM t;
count(*)
8388608
set tokudb_bulk_fetch = ON;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
set tokudb_bulk_fetch = OFF;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
delete from t where val > 0;
1
drop table t;
